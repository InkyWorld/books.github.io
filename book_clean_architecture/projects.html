<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–∞ 9: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–µ–∫—Ç—ã - Clean Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        h1, h2, h3, h4 { color: #0f172a; font-weight: 800; letter-spacing: -0.025em; }
        p, li { font-family: 'Merriweather', serif; line-height: 1.8; color: #334155; margin-bottom: 1em; }
        
        .sidebar { background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); border-right: 1px solid #334155; height: 100vh; position: fixed; width: 18rem; overflow-y: auto; z-index: 50; }
        .sidebar-title { color: #f8fafc; }
        .sidebar-subtitle { color: #60a5fa; }
        .nav-section { color: #94a3b8; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; padding: 1rem 1rem 0.5rem; }
        .nav-link { display: block; padding: 0.6rem 1rem; color: #94a3b8; font-weight: 500; font-size: 0.875rem; transition: all 0.2s; border-left: 3px solid transparent; text-decoration: none; }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: #f1f5f9; border-left-color: #475569; }
        .nav-link.active { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border-left-color: #3b82f6; }

        pre {
            font-family: 'JetBrains Mono', monospace;
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            font-size: 0.85rem;
            line-height: 1.6;
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin: 1.5rem 0;
        }
        .code-comment { color: #94a3b8; font-style: italic; }
        .code-keyword { color: #c084fc; font-weight: bold; } 
        .code-class { color: #fbbf24; font-weight: bold; }   
        .code-func { color: #60a5fa; font-weight: bold; }    
        .code-str { color: #a3e635; }                        
        .code-dec { color: #f472b6; } 

        .card { background: white; border-radius: 1rem; padding: 2.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; border: 1px solid #e2e8f0; }
        
        .step-number { display: inline-flex; justify-content: center; align-items: center; width: 2rem; height: 2rem; border-radius: 9999px; background: #2563eb; color: white; font-weight: bold; margin-right: 0.75rem; }
        .step-header { display: flex; align-items: center; margin-bottom: 1.5rem; }
    </style>
</head>
<body class="flex bg-slate-50">

    <!-- SIDEBAR -->
    <aside class="sidebar hidden md:block">
        <div class="p-6 border-b border-gray-700">
            <h1 class="text-xl font-bold sidebar-title">Clean Architecture</h1>
            <span class="sidebar-subtitle text-sm">Python Junior Guide</span>
        </div>
        <nav class="py-4">
            <div class="px-4 mb-4">
                <div class="flex gap-2 text-xs font-bold text-slate-400">
                    <a href="#" class="hover:text-white transition">RU</a>
                    <span class="text-slate-600">|</span>
                    <a href="#" class="hover:text-white transition">EN</a>
                    <span class="text-slate-600">|</span>
                    <a href="#" class="hover:text-white transition">dUA</a>
                </div>
            </div>

            <div class="nav-section">–û—Å–Ω–æ–≤—ã</div>
            <a href="index.html" class="nav-link ">üìò –í–≤–µ–¥–µ–Ω–∏–µ</a>
            
            <div class="nav-section">–°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</div>
            <a href="domain.html" class="nav-link ">üéØ Domain Layer</a>
            <a href="application.html" class="nav-link ">‚öôÔ∏è Application Layer</a>
            <a href="infrastructure.html" class="nav-link ">üîß Infrastructure Layer</a>
            <a href="presentation.html" class="nav-link ">üåê Presentation Layer</a>
            
            <div class="nav-section">–ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã</div>
            <a href="solid.html" class="nav-link ">üìê SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã</a>
            <a href="invariants.html" class="nav-link ">üõ°Ô∏è –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã</a>
            <a href="dependency.html" class="nav-link ">üíâ Dependency Injection</a>
            <a href="cqrs_es.html" class="nav-link ">‚ö° CQRS –∏ ES</a>
            
            <div class="nav-section">Security & Production</div>
            <a href="security.html" class="nav-link ">üîê Auth & Permissions</a>
            <a href="concurrency.html" class="nav-link ">üõë Concurrency & Migrations</a>
            <a href="background_tasks.html" class="nav-link ">‚è≥ Background Tasks</a>
            <a href="error_handling.html" class="nav-link ">üö´ Error Handling</a>
            <a href="config_logging.html" class="nav-link ">‚öôÔ∏è Config & Observability</a>

            <div class="nav-section">DDD Patterns</div>
            <a href="bounded_context.html" class="nav-link ">üåç Bounded Contexts</a>
            <a href="modular_monolith.html" class="nav-link ">üèóÔ∏è Modular Monolith</a>
            <a href="aggregates.html" class="nav-link ">üì¶ Aggregates</a>
            <a href="value_objects.html" class="nav-link ">üíé Value Objects</a>
            <a href="repository_uow.html" class="nav-link ">üóÑÔ∏è Repository & UoW</a>
            <a href="specification.html" class="nav-link ">üìã Specification</a>

            <div class="nav-section">EDA & Dist. Systems</div>
            <a href="domain_events.html" class="nav-link ">üì£ Domain Events</a>
            <a href="saga.html" class="nav-link ">üîÑ Saga Pattern</a>
            <a href="outbox.html" class="nav-link ">üìÆ Outbox Pattern</a>

            <div class="nav-section">Frameworks & –ü—Ä–∞–∫—Ç–∏–∫–∞</div>
            <a href="frameworks_django.html" class="nav-link ">üêç Django & Others</a>
            <a href="advanced_techniques.html" class="nav-link ">üöÄ Advanced Tech</a>
            <a href="deployment.html" class="nav-link ">üöÄ Deployment & Protection</a>
            <a href="testing.html" class="nav-link ">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a href="projects.html" class="nav-link active">üöÄ –ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç—ã</a>
            <a href="antipatterns.html" class="nav-link ">‚ö†Ô∏è –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã</a>
        </nav>
    </aside>

    <!-- CONTENT -->
    <main class="flex-1 md:ml-72 p-8 md:p-12 max-w-5xl mx-auto">
        
        <header id="intro" class="mb-12 pb-6 border-b border-gray-200">
            <div class="flex items-center gap-3 mb-2">
                <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Practice</span>
                <span class="text-gray-400 text-sm font-mono">Full Stack Flow</span>
            </div>
            <h1 class="text-4xl font-extrabold text-gray-900 leading-tight">–ü—Ä–∞–∫—Ç–∏–∫–∞: –°–∏—Å—Ç–µ–º–∞ –ü–ª–∞—Ç–µ–∂–µ–π</h1>
            <p class="text-xl text-gray-500 mt-4 font-light">
                –°–æ–±–µ—Ä–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ñ–∏—á—É "–û–ø–ª–∞—Ç–∞ –ó–∞–∫–∞–∑–∞" –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞, –ø—Ä–æ–π–¥—è —á–µ—Ä–µ–∑ –≤—Å–µ —Å–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
            </p>
        </header>

        <!-- OVERVIEW -->
        <section class="card bg-gray-50 border-gray-200">
            <h2 class="text-2xl font-bold mb-4">–ó–∞–¥–∞—á–∞</h2>
            <p>–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞.</p>
            <ul class="list-disc pl-6 mb-4 text-sm font-semibold text-gray-700">
                <li>–ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω ‚Äî –æ—à–∏–±–∫–∞.</li>
                <li>–ï—Å–ª–∏ —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî –æ—à–∏–±–∫–∞.</li>
                <li>–ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî –º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.</li>
                <li>–í –∫–æ–Ω—Ü–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ–∫ –Ω–∞ Email.</li>
            </ul>
        </section>

        <!-- STEP 1: DOMAIN -->
        <section class="mb-16">
            <div class="step-header">
                <div class="step-number">1</div>
                <h2 class="text-2xl font-bold">Domain Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)</h2>
            </div>
            <p>–ù–∞—á–∏–Ω–∞–µ–º —Å —Å—É—â–Ω–æ—Å—Ç–µ–π. –ù–∏–∫–∞–∫–∏—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ JSON. –¢–æ–ª—å–∫–æ –∫–ª–∞—Å—Å—ã –∏ –ø—Ä–∞–≤–∏–ª–∞.</p>

<pre><code class="language-python"><span class="code-comment"># domain/entities.py</span>
<span class="code-keyword">from</span> dataclasses <span class="code-keyword">import</span> dataclass, field
<span class="code-keyword">import</span> uuid
<span class="code-keyword">from</span> datetime <span class="code-keyword">import</span> datetime
<span class="code-keyword">from</span> .value_objects <span class="code-keyword">import</span> Money

<span class="code-comment"># Exceptions</span>
<span class="code-keyword">class</span> <span class="code-class">OrderAlreadyPaid</span>(Exception): <span class="code-keyword">pass</span>
<span class="code-keyword">class</span> <span class="code-class">InvalidPaymentAmount</span>(Exception): <span class="code-keyword">pass</span>


<span class="code-keyword">class</span> <span class="code-class">Order</span>:
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, id: uuid.UUID, total: Money):
        self.id = id
        self.total = total
        self.is_paid = <span class="code-keyword">False</span>
        self.paid_at = <span class="code-keyword">None</span>

    <span class="code-keyword">def</span> <span class="code-func">pay</span>(self, payment_amount: Money):
        <span class="code-str">"""–ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏"""</span>
        
        <span class="code-comment"># 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã</span>
        <span class="code-keyword">if</span> self.is_paid:
            <span class="code-keyword">raise</span> OrderAlreadyPaid(<span class="code-str">"–ó–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω"</span>)
        
        <span class="code-comment"># –°—Ä–∞–≤–Ω–µ–Ω–∏–µ Value Objects —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã __eq__ –∏ currency check)</span>
        <span class="code-keyword">if</span> payment_amount != self.total:
            <span class="code-keyword">raise</span> InvalidPaymentAmount(<span class="code-str">f"–û–∂–∏–¥–∞–ª–∞—Å—å —Å—É–º–º–∞ {self.total}, –ø–æ–ª—É—á–µ–Ω–æ {payment_amount}"</span>)

        <span class="code-comment"># 2. –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ</span>
        self.is_paid = <span class="code-keyword">True</span>
        self.paid_at = datetime.utcnow()
</code></pre>
        </section>

        <!-- STEP 2: APPLICATION -->
        <section class="mb-16">
            <div class="step-header">
                <div class="step-number">2</div>
                <h2 class="text-2xl font-bold">Application Layer (–°—Ü–µ–Ω–∞—Ä–∏–π)</h2>
            </div>
            <p>–ü–∏—à–µ–º Use Case. –ù–∞–º –Ω—É–∂–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.</p>

<pre><code class="language-python"><span class="code-comment"># application/ports.py</span>
<span class="code-keyword">from</span> abc <span class="code-keyword">import</span> ABC, abstractmethod
<span class="code-keyword">from</span> domain.entities <span class="code-keyword">import</span> Order

<span class="code-keyword">class</span> <span class="code-class">OrderRepository</span>(ABC):
    <span class="code-dec">@abstractmethod</span>
    <span class="code-keyword">def</span> <span class="code-func">get</span>(self, id: uuid.UUID) -> Order: ...
    
    <span class="code-dec">@abstractmethod</span>
    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order): ...

<span class="code-keyword">class</span> <span class="code-class">EmailService</span>(ABC):
    <span class="code-dec">@abstractmethod</span>
    <span class="code-keyword">def</span> <span class="code-func">send_receipt</span>(self, order_id: uuid.UUID): ...
</code></pre>

<pre><code class="language-python"><span class="code-comment"># application/use_cases.py</span>
<span class="code-keyword">from</span> dataclasses <span class="code-keyword">import</span> dataclass
<span class="code-keyword">from</span> decimal <span class="code-keyword">import</span> Decimal
<span class="code-keyword">from</span> .ports <span class="code-keyword">import</span> OrderRepository, EmailService
<span class="code-keyword">from</span> domain.value_objects <span class="code-keyword">import</span> Money

<span class="code-dec">@dataclass</span>
<span class="code-keyword">class</span> <span class="code-class">PayOrderCommand</span>:
    order_id: uuid.UUID
    amount: Decimal
    currency: str

<span class="code-keyword">class</span> <span class="code-class">PayOrderUseCase</span>:
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, repo: OrderRepository, email_service: EmailService):
        self.repo = repo
        self.email = email_service

    <span class="code-keyword">def</span> <span class="code-func">execute</span>(self, cmd: PayOrderCommand):
        <span class="code-comment"># 1. –ó–∞–≥—Ä—É–∂–∞–µ–º</span>
        order = self.repo.get(cmd.order_id)
        <span class="code-keyword">if</span> <span class="code-keyword">not</span> order:
            <span class="code-keyword">raise</span> Exception(<span class="code-str">"Order not found"</span>) <span class="code-comment"># –õ—É—á—à–µ —Å–≤–æ–π OrderNotFound</span>

        <span class="code-comment"># 2. –í—ã–ø–æ–ª–Ω—è–µ–º –¥–æ–º–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</span>
        payment_amount = Money(cmd.amount, cmd.currency)
        order.pay(payment_amount)

        <span class="code-comment"># 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º</span>
        self.repo.save(order)

        <span class="code-comment"># 4. –°–∞–π–¥-—ç—Ñ—Ñ–µ–∫—Ç—ã (–º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ Event Handler)</span>
        self.email.send_receipt(order.id)
</code></pre>
        </section>

        <!-- STEP 3: INFRASTRUCTURE -->
        <section class="mb-16">
            <div class="step-header">
                <div class="step-number">3</div>
                <h2 class="text-2xl font-bold">Infrastructure Layer (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)</h2>
            </div>
            <p>–†–µ–∞–ª–∏–∑—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —á–µ—Ä–µ–∑ SQL Alchemy.</p>

<pre><code class="language-python"><span class="code-comment"># infrastructure/db.py</span>
<span class="code-keyword">from</span> sqlalchemy.orm <span class="code-keyword">import</span> Session
<span class="code-keyword">from</span> domain.entities <span class="code-keyword">import</span> Order
<span class="code-keyword">from</span> application.ports <span class="code-keyword">import</span> OrderRepository

<span class="code-keyword">class</span> <span class="code-class">SqlOrderRepository</span>(OrderRepository):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, session: Session):
        self.session = session

    <span class="code-keyword">def</span> <span class="code-func">get</span>(self, id: uuid.UUID) -> Order:
        <span class="code-comment"># Model -> Entity mapping</span>
        row = self.session.query(OrderModel).filter_by(id=str(id)).first()
        <span class="code-keyword">if</span> <span class="code-keyword">not</span> row:
            <span class="code-keyword">return</span> <span class="code-keyword">None</span>
        
        <span class="code-comment"># –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Entity</span>
        order = Order(uuid.UUID(row.id), Money(row.amount, row.currency))
        order.is_paid = row.is_paid <span class="code-comment"># –í–∞–∂–Ω–æ! –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ</span>
        <span class="code-keyword">return</span> order

    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order):
        <span class="code-comment"># Entity -> Model mapping</span>
        row = OrderModel(
            id=str(order.id),
            amount=order.total.amount,
            currency=order.total.currency,
            is_paid=order.is_paid
        )
        self.session.merge(row)
        self.session.commit()
</code></pre>
        </section>

        <!-- STEP 4: PRESENTATION -->
        <section class="mb-16">
            <div class="step-header">
                <div class="step-number">4</div>
                <h2 class="text-2xl font-bold">Presentation Layer (API)</h2>
            </div>
            <p>–ü–æ–¥–∫–ª—é—á–∞–µ–º FastAPI.</p>

<pre><code class="language-python"><span class="code-comment"># presentation/api.py</span>
<span class="code-keyword">from</span> fastapi <span class="code-keyword">import</span> APIRouter, Depends
<span class="code-keyword">from</span> pydantic <span class="code-keyword">import</span> BaseModel

<span class="code-keyword">class</span> <span class="code-class">PaymentRequest</span>(BaseModel):
    amount: float
    currency: str

<span class="code-dec">@router.post</span>(<span class="code-str">"/orders/{order_id}/pay"</span>)
<span class="code-keyword">def</span> <span class="code-func">pay_order_endpoint</span>(
    order_id: uuid.UUID,
    request: PaymentRequest,
    <span class="code-comment"># –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</span>
    use_case: PayOrderUseCase = Depends(get_pay_order_use_case)
):
    <span class="code-keyword">try</span>:
        cmd = PayOrderCommand(order_id, Decimal(request.amount), request.currency)
        use_case.execute(cmd)
        <span class="code-keyword">return</span> {<span class="code-str">"status"</span>: <span class="code-str">"success"</span>}
    <span class="code-keyword">except</span> OrderAlreadyPaid:
        <span class="code-keyword">raise</span> HTTPException(409, <span class="code-str">"Already paid"</span>)
    <span class="code-keyword">except</span> InvalidPaymentAmount:
        <span class="code-keyword">raise</span> HTTPException(400, <span class="code-str">"Wrong amount"</span>)
</code></pre>
        </section>

    
        <!-- NAVIGATION FOOTER -->
        
        <!-- NAVIGATION FOOTER -->
        
        <!-- NAVIGATION FOOTER -->
        <div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><a href="testing.html" class="group border border-gray-300 rounded-lg p-4 w-full md:w-1/2 hover:border-blue-500 hover:shadow-md transition text-right"><span class="block text-xs text-gray-500 font-bold uppercase tracking-wide mb-1 flex justify-end">–ù–∞–∑–∞–¥</span><span class="block text-lg font-bold text-gray-800 group-hover:text-blue-600">&larr; Testing</span></a><a href="antipatterns.html" class="group border border-gray-300 rounded-lg p-4 w-full md:w-1/2 hover:border-blue-500 hover:shadow-md transition text-left"><span class="block text-xs text-gray-500 font-bold uppercase tracking-wide mb-1">–î–∞–ª–µ–µ</span><span class="block text-lg font-bold text-gray-800 group-hover:text-blue-600">Antipatterns &rarr;</span></a></div></div>
    </main>
</body>
</html>