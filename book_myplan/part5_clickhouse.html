<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5.2 ClickHouse Analytics ‚Äî ScaleTrade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="book-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üìà</div>
                    <span>ScaleTrade</span>
                </a>
            </div>
            <nav class="sidebar-nav">
    <div class="nav-section">
        <div class="nav-section-title">Intro</div>
        <a href="index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="setup.html" class="nav-link">üõ† Setup</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 0: Fundamentals</div>
        <a href="part0_internals.html" class="nav-link">0.1 Internals</a>
        <a href="part0_networking.html" class="nav-link">0.2 Networking</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 1: Postgres</div>
        <a href="part1_schema.html" class="nav-link">1.1 Schema</a>
        <a href="part1_indexes.html" class="nav-link">1.2 Indexes</a>
        <a href="part1_transactions.html" class="nav-link">1.3 Transactions</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 2: Litestar</div>
        <a href="part2_litestar.html" class="nav-link">2.1 Framework</a>
        <a href="part2_dishka.html" class="nav-link">2.2 DI (Dishka)</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 3: Brokers</div>
        <a href="part3_redis.html" class="nav-link">3.1 Redis</a>
        <a href="part3_faststream.html" class="nav-link">3.2 FastStream</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 4: Quality</div>
        <a href="part4_testing.html" class="nav-link">4.1 Pytest</a>
        <a href="part4_resiliency.html" class="nav-link">4.2 Resilience</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 5: Observability</div>
        <a href="part5_clickhouse.html" class="nav-link active">5.1 Clickhouse</a>
        <a href="part5_logging.html" class="nav-link">5.2 Structured Logs</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 6: Django</div>
        <a href="part6_django.html" class="nav-link">6.1 ORM</a>
        <a href="part6_migrations.html" class="nav-link">6.2 Migrations</a>
        <a href="part6_quality.html" class="nav-link">6.3 Quality</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 7: Microservices</div>
        <a href="part7_grpc.html" class="nav-link">7.1 gRPC</a>
        <a href="part7_graphql.html" class="nav-link">7.2 GraphQL</a>
        <a href="part7_federation.html" class="nav-link">7.3 Federation</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 8: Async</div>
        <a href="part8_asyncio.html" class="nav-link">8.1 Asyncio</a>
        <a href="part8_celery.html" class="nav-link">8.2 Celery</a>
        <a href="part8_dramatiq.html" class="nav-link">8.3 Dramatiq</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 9: API</div>
        <a href="part9_restdesign.html" class="nav-link">9.1 REST Design</a>
        <a href="part9_idempotency.html" class="nav-link">9.2 Idempotency</a>
        <a href="part9_openapi.html" class="nav-link">9.3 OpenAPI</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 10: Culture</div>
        <a href="part10_git.html" class="nav-link">10.1 Git</a>
        <a href="part10_commits.html" class="nav-link">10.2 Commits</a>
        <a href="part10_codereview.html" class="nav-link">10.3 Post-Review</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 11: Security</div>
        <a href="part11_oauth.html" class="nav-link">11.1 OAuth2</a>
        <a href="part11_vault.html" class="nav-link">11.2 Vault</a>
        <a href="part11_owasp.html" class="nav-link">11.3 OWASP</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 12: Kubernetes</div>
        <a href="part12_kubernetes.html" class="nav-link">12.1 K8s Basics</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 13: High Load</div>
        <a href="part13_profiling.html" class="nav-link">13.1 Profiling</a>
        <a href="part13_caching.html" class="nav-link">13.2 Caching</a>
        <a href="part13_loadbalancing.html" class="nav-link">13.3 Load Balancing</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 14: ML Ops</div>
        <a href="part14_mlflow.html" class="nav-link">14.1 MLflow</a>
        <a href="part14_embeddings.html" class="nav-link">14.2 Embeddings</a>
        <a href="part14_llm.html" class="nav-link">14.3 LLM</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 15: Debugging</div>
        <a href="part15_debugging.html" class="nav-link">15.1 Debugging</a>
        <a href="part15_postmortem.html" class="nav-link">15.2 Postmortem</a>
        <a href="part15_chaos.html" class="nav-link">15.3 Chaos Eng</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 16: DB Advanced</div>
        <a href="part16_indexes.html" class="nav-link">16.1 Indexes Deep</a>
        <a href="part16_isolation.html" class="nav-link">16.2 Isolation</a>
        <a href="part16_sharding.html" class="nav-link">16.3 Sharding</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 17: System Design</div>
        <a href="part17_circuit.html" class="nav-link">17.1 Circuit Breaker</a>
        <a href="part17_ratelimit.html" class="nav-link">17.2 Rate Limit</a>
        <a href="part17_distlock.html" class="nav-link">17.3 Dist Lock</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 18: Soft Skills</div>
        <a href="part18_estimation.html" class="nav-link">18.1 Estimation</a>
        <a href="part18_burnout.html" class="nav-link">18.2 Burnout</a>
        <a href="part18_interview.html" class="nav-link">18.3 Interview</a>
    </div>
</nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="breadcrumb">
                    <a href="index.html">ScaleTrade</a>
                    <span>/</span>
                    <span>–ß–∞—Å—Ç—å 5</span>
                    <span>/</span>
                    <span>5.2 ClickHouse</span>
                </div>
            </header>

            <div class="page-content">
                <h1>–ú–æ–¥—É–ª—å 5.2: ClickHouse Analytics</h1>
                <p class="lead">
                    OLAP –±–∞–∑–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: MergeTree, Materialized Views, async batch insert.
                </p>

                <h2>–ó–∞—á–µ–º ClickHouse?</h2>

                <table>
                    <thead>
                        <tr>
                            <th>PostgreSQL (OLTP)</th>
                            <th>ClickHouse (OLAP)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>–°—Ç—Ä–æ–∫–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ</td>
                            <td>–ö–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ</td>
                        </tr>
                        <tr>
                            <td>ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</td>
                            <td>Eventual consistency</td>
                        </tr>
                        <tr>
                            <td>–ë—ã—Å—Ç—Ä—ã–π CRUD</td>
                            <td>–ë—ã—Å—Ç—Ä—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏</td>
                        </tr>
                        <tr>
                            <td>Orders, Users, Wallets</td>
                            <td>–õ–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</td>
                        </tr>
                    </tbody>
                </table>

                <h2>–ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã (Deep Dive)</h2>
                <p>–ü–æ—á–µ–º—É ClickHouse —Ç–∞–∫–æ–π –±—ã—Å—Ç—Ä—ã–π? –°–µ–∫—Ä–µ—Ç –Ω–µ –≤ –º–∞–≥–∏–∏, –∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.</p>
                
                <h3>1. –ö–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ</h3>
                <p>–í —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –ë–î (Postgres, MySQL) –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏: <code>[User, Date, Amount]</code>. –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω—é—é —Å—É–º–º—É (Amount), –±–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å –¥–∏—Å–∫–∞ –≤—Å—é —Å—Ç—Ä–æ–∫—É, –≤–∫–ª—é—á–∞—è –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (User, Date). –≠—Ç–æ –ª–∏—à–Ω–∏–π I/O.</p>
                <p>ClickHouse —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∂–¥—É—é –∫–æ–ª–æ–Ω–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ. –ó–∞–ø—Ä–æ—Å <code>sum(Amount)</code> —á–∏—Ç–∞–µ—Ç <strong>—Ç–æ–ª—å–∫–æ</strong> —Ñ–∞–π–ª —Å –∫–æ–ª–æ–Ω–∫–æ–π Amount. –ü–ª—é—Å, –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ (—á–∏—Å–ª–∞, –¥–∞—Ç—ã) –æ—Ç–ª–∏—á–Ω–æ —Å–∂–∏–º–∞—é—Ç—Å—è –∫–æ–¥–µ–∫–∞–º–∏ (LZ4, ZSTD), —É–º–µ–Ω—å—à–∞—è –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ –≤ 10-100 —Ä–∞–∑.</p>

                <h3>2. –†–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (Sparse Index)</h3>
                <p>–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç B-Tree –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ Postgres, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ <strong>–∫–∞–∂–¥—É—é</strong> —Å—Ç—Ä–æ–∫—É, ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å. –û–Ω —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞–∂–¥–æ–π N-–π —Å—Ç—Ä–æ–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8192). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –≤–µ—Å—å –∏–Ω–¥–µ–∫—Å –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞—Ö–æ–¥—è –Ω—É–∂–Ω—ã–µ –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–≥—Ä–∞–Ω—É–ª—ã) –¥–ª—è —á—Ç–µ–Ω–∏—è.</p>

                <h2>MergeTree Engine</h2>
                <p>–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–≤–∏–∂–æ–∫ —Ç–∞–±–ª–∏—Ü –≤ ClickHouse. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É LSM-tree (Log-Structured Merge-tree):</p>
                <ul>
                    <li>–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤ –Ω–æ–≤—É—é –ø–∞–ø–∫—É (Part) –Ω–∞ –¥–∏—Å–∫–µ.</li>
                    <li>–í —Ñ–æ–Ω–µ ClickHouse –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç (merge) –º–µ–ª–∫–∏–µ –ø–∞—Ä—Ç—ã –≤ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–µ.</li>
                    <li>–î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É (ORDER BY).</li>
                </ul>

<pre><code><span class="comment">-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–±—ã—Ç–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏</span>
<span class="keyword">CREATE TABLE</span> trade_events
(
    event_id        UUID,
    event_time      DateTime64(<span class="number">3</span>),  <span class="comment">-- –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã</span>
    event_type      LowCardinality(String),  <span class="comment">-- order_created, order_filled, etc.</span>
    order_id        UUID,
    user_id         UInt64,
    symbol          LowCardinality(String),
    side            Enum8(<span class="string">'buy'</span> = <span class="number">1</span>, <span class="string">'sell'</span> = <span class="number">2</span>),
    quantity        Decimal(<span class="number">18</span>, <span class="number">8</span>),
    price           Decimal(<span class="number">18</span>, <span class="number">2</span>),
    total_value     Decimal(<span class="number">18</span>, <span class="number">2</span>),
    
    <span class="comment">-- Partition key (–ø–æ –º–µ—Å—è—Ü–∞–º)</span>
    event_date      Date <span class="keyword">MATERIALIZED</span> toDate(event_time)
)
<span class="keyword">ENGINE</span> = MergeTree()
<span class="keyword">PARTITION BY</span> toYYYYMM(event_date)
<span class="keyword">ORDER BY</span> (symbol, event_time, user_id)  <span class="comment">-- –ö–ª—é—á —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</span>
<span class="keyword">TTL</span> event_d–ú–∞–≥–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h2>
                <p>–í Postgres <code>MATERIALIZED VIEW</code> ‚Äî —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Å–ª–µ–ø–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é –∫–æ–º–∞–Ω–¥–æ–π <code>REFRESH MATERIALIZED VIEW</code>. –≠—Ç–æ —Ç—è–∂–µ–ª–æ –∏ –¥–æ–ª–≥–æ.</p>
                <p>–í ClickHouse Materialized View ‚Äî —ç—Ç–æ <strong>—Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ –≤—Å—Ç–∞–≤–∫—É (INSERT)</strong>. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É-–∏—Å—Ç–æ—á–Ω–∏–∫, ClickHouse –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫ –Ω–µ–º—É –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ü–µ–ª–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É. –î–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –Ω–∞ –ª–µ—Ç—É. –ú—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∑–∞–Ω–æ–≤–æ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ —Å–µ–∫—É–Ω–¥—ã, –¥–∞–∂–µ –Ω–∞ –ø–µ—Ç–∞–±–∞–π—Ç–∞—Ö –¥–∞–Ω–Ω—ã—Ö.</ppan class="number">1</span> YEAR  <span class="comment">-- –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–æ–¥</span>
<span class="keyword">SETTINGS</span> index_granularity = <span class="number">8192</span>;

<span class="comment">-- –ó–∞–ø—Ä–æ—Å: —Ç–æ–ø-10 —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ –∑–∞ –¥–µ–Ω—å</span>
<span class="keyword">SELECT</span>
    user_id,
    count() <span class="keyword">AS</span> trades_count,
    sum(total_value) <span class="keyword">AS</span> volume
<span class="keyword">FROM</span> trade_events
<span class="keyword">WHERE</span> 
    event_type = <span class="string">'order_filled'</span>
    <span class="keyword">AND</span> event_date = today()
<span class="keyword">GROUP BY</span> user_id
<span class="keyword">ORDER BY</span> volume <span class="keyword">DESC</span>
<span class="keyword">LIMIT</span> <span class="number">10</span>;</code></pre>

                <h2>Materialized Views: –ø—Ä–µ–¥–∞–≥—Ä–µ–≥–∞—Ü–∏—è</h2>

<pre><code><span class="comment">-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ (target)</span>
<span class="keyword">CREATE TABLE</span> daily_user_stats
(
    stat_date       Date,
    user_id         UInt64,
    symbol          LowCardinality(String),
    trades_count    AggregateFunction(count, UInt64),
    total_volume    AggregateFunction(sum, Decimal(<span class="number">18</span>, <span class="number">2</span>)),
    avg_price       AggregateFunction(avg, Decimal(<span class="number">18</span>, <span class="number">2</span>))
)
<span class="keyword">ENGINE</span> = AggregatingMergeTree()
<span class="keyword">PARTITION BY</span> toYYYYMM(stat_date)
<span class="keyword">ORDER BY</span> (stat_date, user_id, symbol);

<span class="comment">-- Materialized View: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
<span class="keyword">CREATE MATERIALIZED VIEW</span> daily_user_stats_mv
<span class="keyword">TO</span> daily_user_stats
<span class="keyword">AS SELECT</span>
    toDate(event_time) <span class="keyword">AS</span> stat_date,
    user_id,
    symbol,
    countState() <span class="keyword">AS</span> trades_count,
    sumState(total_value) <span class="keyword">AS</span> total_volume,
    avgState(price) <span class="keyword">AS</span> avg_price
<span class="keyword">FROM</span> trade_events
<span class="keyword">WHERE</span> event_type = <span class="string">'order_filled'</span>
<span class="keyword">GROUP BY</span> stat_date, user_id, symbol;

<span class="comment">-- –ó–∞–ø—Ä–æ—Å –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π!)</span>
<span class="keyword">SELECT</span>
    stat_date,
    user_id,
    countMerge(trades_count) <span class="keyword">AS</span> trades,
    sumMerge(total_volume) <span class="keyword">AS</span> volume,
    avgMerge(avg_price) <span class="keyword">AS</span> avg_price
<span class="keyword">FROM</span> daily_user_stats
<span class="keyword">WHERE</span> stat_date >= today() - <span class="number">7</span>
<span class="keyword">GROUP BY</span> stat_date, user_id
<span class="keyword–ü—Ä–æ–±–ª–µ–º–∞ –º–µ–ª–∫–∏—Ö –≤—Å—Ç–∞–≤–æ–∫ (Async Batch Insert)</h2>
                <p>ClickHouse –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ª—è –≤—Å—Ç–∞–≤–∫–∏ –±–æ–ª—å—à–∏–º–∏ –ø–∞—á–∫–∞–º–∏ (–±–∞—Ç—á–∞–º–∏). –ö–∞–∂–¥—ã–π <code>INSERT</code> —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –ø–∞–ø–∫—É (Part) –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å 1000 –∏–Ω—Å–µ—Ä—Ç–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É, —Å–æ–∑–¥–∞—Å—Ç—Å—è 1000 –º–µ–ª–∫–∏—Ö —Ñ–∞–π–ª–æ–≤. –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –º–µ—Ä–∂–∞ –Ω–µ –±—É–¥–µ—Ç —É—Å–ø–µ–≤–∞—Ç—å –∏—Ö –æ–±—ä–µ–¥–∏–Ω—è—Ç—å, –∏ –±–∞–∑–∞ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É <code>Too many parts</code>.</p>
                <p>–ü–æ—ç—Ç–æ–º—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> –Ω—É–∂–µ–Ω –±—É—Ñ–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –ø–∏—à–µ—Ç –∏—Ö –≤ ClickHouse —Ä–∞–∑ –≤ N —Å–µ–∫—É–Ω–¥ –∏–ª–∏ –ø—Ä–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–∏ N —Å–æ–±—ã—Ç–∏–π.</plass="keyword">DESC</span>;</code></pre>

                <h2>Async Batch Insert –∏–∑ Python</h2>

<pre><code><span class="comment"># src/scaletrade/infrastructure/clickhouse/client.py</span>
<span class="keyword">import</span> asyncio
<span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<span class="keyword">from</span> typing <span class="keyword">import</span> Generic, TypeVar
<span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sequence

<span class="keyword">from</span> clickhouse_connect <span class="keyword">import</span> get_async_client
<span class="keyword">from</span> clickhouse_connect.driver.asyncclient <span class="keyword">import</span> AsyncClient

T = TypeVar(<span class="string">"T"</span>)


<span class="decorator">@dataclass</span>
<span class="keyword">class</span> <span class="class-name">BatchBuffer</span>(Generic[T]):
    <span class="string">"""
    –ë—É—Ñ–µ—Ä –¥–ª—è batch insert.
    
    –°–æ–±–∏—Ä–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—á–∫–∞–º–∏:
    - –ü–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é max_size
    - –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é flush_interval
    """</span>
    max_size: <span class="type">int</span> = <span class="number">1000</span>
    flush_interval: <span class="type">float</span> = <span class="number">5.0</span>  <span class="comment"># —Å–µ–∫—É–Ω–¥</span>
    
    _buffer: <span class="type">list</span>[T] = field(default_factory=<span class="type">list</span>, init=<span class="keyword">False</span>)
    _lock: asyncio.Lock = field(default_factory=asyncio.Lock, init=<span class="keyword">False</span>)
    _last_flush: <span class="type">float</span> = field(default_factory=<span class="keyword">lambda</span>: asyncio.get_event_loop().time(), init=<span class="keyword">False</span>)
    
    <span class="keyword">async def</span> <span class="function">add</span>(self, item: T) -> <span class="type">bool</span>:
        <span class="string">"""–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ –Ω—É–∂–µ–Ω flush."""</span>
        <span class="keyword">async with</span> self._lock:
            self._buffer.append(item)
            <span class="keyword">return</span> self._should_flush()
    
    <span class="keyword">def</span> <span class="function">_should_flush</span>(self) -> <span class="type">bool</span>:
        now = asyncio.get_event_loop().time()
        size_trigger = len(self._buffer) >= self.max_size
        time_trigger = (now - self._last_flush) >= self.flush_interval
        <span class="keyword">return</span> size_trigger <span class="keyword">or</span> time_trigger
    
    <span class="keyword">async def</span> <span class="function">flush</span>(self) -> Sequence[T]:
        <span class="string">"""–ó–∞–±—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –±—É—Ñ–µ—Ä–∞."""</span>
        <span class="keyword">async with</span> self._lock:
            items = self._buffer.copy()
            self._buffer.clear()
            self._last_flush = asyncio.get_event_loop().time()
            <span class="keyword">return</span> items


<span class="keyword">class</span> <span class="class-name">ClickHouseEventWriter</span>:
    <span class="string">"""
    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π writer —Å–æ–±—ã—Ç–∏–π –≤ ClickHouse.
    
    Features:
    - Batch insert –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    - Background flush –ø–æ —Ç–∞–π–º–µ—Ä—É
    - Graceful shutdown
    """</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(
        self,
        client: AsyncClient,
        table: <span class="type">str</span>,
        columns: <span class="type">list</span>[<span class="type">str</span>],
        batch_size: <span class="type">int</span> = <span class="number">1000</span>,
        flush_interval: <span class="type">float</span> = <span class="number">5.0</span>,
    ):
        self._client = client
        self._table = table
        self._columns = columns
        self._buffer = BatchBuffer(
            max_size=batch_size,
            flush_interval=flush_interval,
        )
        self._flush_task: asyncio.Task | <span class="keyword">None</span> = <span class="keyword">None</span>
        self._running = <span class="keyword">False</span>
    
    <span class="keyword">async def</span> <span class="function">start</span>(self) -> <span class="keyword">None</span>:
        <span class="string">"""–ó–∞–ø—É—Å–∫ background flush."""</span>
        self._running = <span class="keyword">True</span>
        self._flush_task = asyncio.create_task(self._flush_loop())
    
    <span class="keyword">async def</span> <span class="function">stop</span>(self) -> <span class="keyword">None</span>:
        <span class="string">"""Graceful shutdown: flush –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö."""</span>
        self._running = <span class="keyword">False</span>
        <span class="keyword">if</span> self._flush_task:
            self._flush_task.cancel()
            <span class="keyword">try</span>:
                <span class="keyword">await</span> self._flush_task
            <span class="keyword">except</span> asyncio.CancelledError:
                <span class="keyword">pass</span>
        <span class="comment"># Final flush</span>
        <span class="keyword">await</span> self._do_flush()
    
    <span class="keyword">async def</span> <span class="function">write</span>(self, event: <span class="type">dict</span>) -> <span class="keyword">None</span>:
        <span class="string">"""–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –±—É—Ñ–µ—Ä."""</span>
        row = [event.get(col) <span class="keyword">for</span> col <span class="keyword">in</span> self._columns]
        should_flush = <span class="keyword">await</span> self._buffer.add(row)
        <span class="keyword">if</span> should_flush:
            <span class="keyword">await</span> self._do_flush()
    
    <span class="keyword">async def</span> <span class="function">_flush_loop</span>(self) -> <span class="keyword">None</span>:
        <span class="string">"""Background task –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ flush."""</span>
        <span class="keyword">while</span> self._running:
            <span class="keyword">await</span> asyncio.sleep(self._buffer.flush_interval)
            <span class="keyword">await</span> self._do_flush()
    
    <span class="keyword">async def</span> <span class="function">_do_flush</span>(self) -> <span class="keyword">None</span>:
        <span class="string">"""–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse."""</span>
        rows = <span class="keyword">await</span> self._buffer.flush()
        <span class="keyword">if not</span> rows:
            <span class="keyword">return</span>
        
        <span class="keyword">await</span> self._client.insert(
            self._table,
            rows,
            column_names=self._columns,
        )</code></pre>

                <h2>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</h2>

<pre><code><span class="comment"># src/scaletrade/infrastructure/clickhouse/event_publisher.py</span>
<span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, asdict
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal
<span class="keyword">from</span> uuid <span class="keyword">import</span> UUID


<span class="decorator">@dataclass</span>
<span class="keyword">class</span> <span class="class-name">TradeEvent</span>:
    <span class="string">"""–°–æ–±—ã—Ç–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏."""</span>
    event_id: UUID
    event_time: datetime
    event_type: <span class="type">str</span>
    order_id: UUID
    user_id: <span class="type">int</span>
    symbol: <span class="type">str</span>
    side: <span class="type">str</span>
    quantity: Decimal
    price: Decimal
    total_value: Decimal


<span class="keyword">class</span> <span class="class-name">AnalyticsEventPublisher</span>:
    <span class="string">"""–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ ClickHouse."""</span>
    
    COLUMNS = [
        <span class="string">"event_id"</span>, <span class="string">"event_time"</span>, <span class="string">"event_type"</span>,
        <span class="string">"order_id"</span>, <span class="string">"user_id"</span>, <span class="string">"symbol"</span>,
        <span class="string">"side"</span>, <span class="string">"quantity"</span>, <span class="string">"price"</span>, <span class="string">"total_value"</span>,
    ]
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self, writer: ClickHouseEventWriter):
        self._writer = writer
    
    <span class="keyword">async def</span> <span class="function">publish_order_created</span>(self, order: Order) -> <span class="keyword">None</span>:
        event = TradeEvent(
            event_id=uuid.uuid4(),
            event_time=datetime.utcnow(),
            event_type=<span class="string">"order_created"</span>,
            order_id=order.id.value,
            user_id=order.user_id.value,
            symbol=order.symbol,
            side=order.side.value,
            quantity=order.quantity.amount,
            price=order.price.amount,
            total_value=order.total_value.amount,
        )
        <span class="keyword">await</span> self._writer.write(asdict(event))
    
    <span class="keyword">async def</span> <span class="function">publish_order_filled</span>(self, order: Order) -> <span class="keyword">None</span>:
        event = TradeEvent(
            event_id=uuid.uuid4(),
            event_time=datetime.utcnow(),
            event_type=<span class="string">"order_filled"</span>,
            order_id=order.id.value,
            user_id=order.user_id.value,
            symbol=order.symbol,
            side=order.side.value,
            quantity=order.quantity.amount,
            price=order.filled_price.amount,  <span class="comment"># –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è</span>
            total_value=order.filled_value.amount,
        )
        <span class="keyword">await</span> self._writer.write(asdict(event))</code></pre>

                <h2>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h2>

<pre><code><span class="comment">-- –í–æ—Ä–æ–Ω–∫–∞: created ‚Üí filled</span>
<span class="keyword">SELECT</span>
    toDate(event_time) <span class="keyword">AS</span> dt,
    countIf(event_type = <span class="string">'order_created'</span>) <span class="keyword">AS</span> created,
    countIf(event_type = <span class="string">'order_filled'</span>) <span class="keyword">AS</span> filled,
    round(filled / created * <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">AS</span> fill_rate_pct
<span class="keyword">FROM</span> trade_events
<span class="keyword">WHERE</span> event_date >= today() - <span class="number">30</span>
<span class="keyword">GROUP BY</span> dt
<span class="keyword">ORDER BY</span> dt;

<span class="comment">-- OHLCV —Å–≤–µ—á–∏ –ø–æ –º–∏–Ω—É—Ç–∞–º</span>
<span class="keyword">SELECT</span>
    toStartOfMinute(event_time) <span class="keyword">AS</span> candle_time,
    symbol,
    argMin(price, event_time) <span class="keyword">AS</span> open,
    max(price) <span class="keyword">AS</span> high,
    min(price) <span class="keyword">AS</span> low,
    argMax(price, event_time) <span class="keyword">AS</span> close,
    sum(quantity) <span class="keyword">AS</span> volume
<span class="keyword">FROM</span> trade_events
<span class="keyword">WHERE</span> 
    event_type = <span class="string">'order_filled'</span>
    <span class="keyword">AND</span> symbol = <span class="string">'BTC/USD'</span>
    <span class="keyword">AND</span> event_time >= now() - INTERVAL <span class="number">1</span> HOUR
<span class="keyword">GROUP BY</span> candle_time, symbol
<span class="keyword">ORDER BY</span> candle_time;

<span class="comment">-- Retention: —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–µ—Ä–Ω—É–ª–∏—Å—å</span>
<span class="keyword">WITH</span> first_trade <span class="keyword">AS</span> (
    <span class="keyword">SELECT</span>
        user_id,
        min(toDate(event_time)) <span class="keyword">AS</span> first_date
    <span class="keyword">FROM</span> trade_events
    <span class="keyword">WHERE</span> event_type = <span class="string">'order_filled'</span>
    <span class="keyword">GROUP BY</span> user_id
)
<span class="keyword">SELECT</span>
    first_date,
    count(<span class="keyword">DISTINCT</span> f.user_id) <span class="keyword">AS</span> cohort_size,
    countIf(<span class="keyword">DISTINCT</span> f.user_id, dateDiff(<span class="string">'day'</span>, first_date, toDate(e.event_time)) = <span class="number">7</span>) <span class="keyword">AS</span> day_7,
    countIf(<span class="keyword">DISTINCT</span> f.user_id, dateDiff(<span class="string">'day'</span>, first_date, toDate(e.event_time)) = <span class="number">30</span>) <span class="keyword">AS</span> day_30
<span class="keyword">FROM</span> first_trade f
<span class="keyword">LEFT JOIN</span> trade_events e <span class="keyword">ON</span> f.user_id = e.user_id
<span class="keyword">WHERE</span> first_date >= today() - <span class="number">90</span>
<span class="keyword">GROUP BY</span> first_date
<span class="keyword">ORDER BY</span> first_date;</code></pre>

                <h2>ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>1. –í—Å—Ç–∞–≤–∫–∞ –ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ClickHouse –∫–∞–∫ PostgreSQL, –¥–µ–ª–∞—è <code>INSERT VALUES</code> –Ω–∞ –∫–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å. –í ClickHouse –∫–∞–∂–¥—ã–π INSERT —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π "Part" (—Ñ–∞–π–ª) –Ω–∞ –¥–∏—Å–∫–µ. –ï—Å–ª–∏ –∏—Ö –±—É–¥–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –±–∞–∑–∞ "–∑–∞—Ö–ª–µ–±–Ω–µ—Ç—Å—è" –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ (merge). –í—Å—Ç–∞–≤–ª—è–π—Ç–µ –±–∞—Ç—á–∞–º–∏ –ø–æ 1000+ —Å—Ç—Ä–æ–∫.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>2. –ú—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (Updates & Deletes)</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–í ClickHouse –Ω–µ—Ç –ø—Ä–∏–≤—ã—á–Ω–æ–≥–æ <code>UPDATE</code>. –ï—Å—Ç—å <code>ALTER TABLE ... UPDATE</code>, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Ü–µ–ª—ã–µ –∫—É—Å–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —Ç—è–∂–µ–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è OLTP –Ω–∞–≥—Ä—É–∑–∫–∏. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>ReplacingMergeTree</code> –∏–ª–∏ <code>CollapsingMergeTree</code>.</p>
                        </div>
                    </div>
                </div>

                <h2>üí° –õ–∞–π—Ñ—Ö–∞–∫–∏</h2>
                <ul>
                    <li><strong>Async Insert:</strong> –ï—Å–ª–∏ –≤–∞–º –ª–µ–Ω—å –ø–∏—Å–∞—Ç—å —Å–≤–æ–π –±–∞—Ç—á–µ—Ä –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∏—Ç–µ <code>async_insert=1</code> –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. ClickHouse —Å–∞–º —Å–æ–±–µ—Ä–µ—Ç –≤—Å—Ç–∞–≤–∫–∏ –≤ –±—É—Ñ–µ—Ä –∏ –∑–∞–ø–∏—à–µ—Ç –∏—Ö –Ω–∞ –¥–∏—Å–∫ –ø–∞—á–∫–æ–π.</li>
                    <li><strong>Materialized Views:</strong> –°–∞–º–∞—è –º–æ—â–Ω–∞—è —Ñ–∏—á–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–∞–Ω–Ω—ã–µ –ª—å—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É <code>events</code>, –∞ MV —Å–∞–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É <code>daily_stats</code>. –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</li>
                    <li><strong>LowCardinality:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç—Ä–æ–∫, –≥–¥–µ –∑–Ω–∞—á–µ–Ω–∏–π –º–∞–ª–æ (—Å—Ç–∞—Ç—É—Å—ã, –≤–∞–ª—é—Ç—ã). –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç GROUP BY –∏ —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ –¥–∏—Å–∫–µ –≤ —Ä–∞–∑—ã.</li>
                    <li><strong>TTL:</strong> –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö: <code>TTL created_at + INTERVAL 1 MONTH DELETE</code>. –ë–∞–∑–∞ —Å–∞–º–∞ –ø–æ—á–∏—Å—Ç–∏—Ç –¥–∏—Å–∫.</li>
                </ul>

                <div class="task-box">
                    <h4>üìã –ó–∞–¥–∞–Ω–∏–µ</h4>
                    <ul class="task-list">
                        <li>–°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É trade_events —Å MergeTree</li>
                        <li>–†–µ–∞–ª–∏–∑—É–π BatchBuffer –¥–ª—è async insert</li>
                        <li>–î–æ–±–∞–≤—å Materialized View –¥–ª—è daily stats</li>
                        <li>–ù–∞–ø–∏—à–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞</li>
                        <li>–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π ClickHouseEventWriter —Å domain events</li>
                    </ul>
                </div>

                <div class="nav-footer">
                    <a href="part5_logging.html">
                        <div>
                            <div class="nav-label">–ù–∞–∑–∞–¥</div>
                            <div class="nav-title">‚Üê 5.1 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                        </div>
                    </a>
                    <a href="part6_migrations.html">
                        <div>
                            <div class="nav-label">–î–∞–ª–µ–µ</div>
                            <div class="nav-title">6.1 Zero-Downtime ‚Üí</div>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
