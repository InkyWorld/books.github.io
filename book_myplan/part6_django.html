<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6.3 Django Admin Integration ‚Äî ScaleTrade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="book-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üìà</div>
                    <span>ScaleTrade</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">–í–≤–µ–¥–µ–Ω–∏–µ</div>
                    <a href="index.html" class="nav-link"><span class="nav-link-icon">üè†</span>–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="setup.html" class="nav-link"><span class="nav-link-icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 1: PostgreSQL</div>
                    <a href="part1_schema.html" class="nav-link"><span class="nav-link-icon">üìä</span>1.1 –°—Ö–µ–º–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ</a>
                    <a href="part1_transactions.html" class="nav-link"><span class="nav-link-icon">üîÑ</span>1.2 –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a>
                    <a href="part1_indexes.html" class="nav-link"><span class="nav-link-icon">üîç</span>1.3 –ò–Ω–¥–µ–∫—Å—ã</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</div>
                    <a href="part2_litestar.html" class="nav-link"><span class="nav-link-icon">üöÄ</span>2.1 Litestar + DDD</a>
                    <a href="part2_dishka.html" class="nav-link"><span class="nav-link-icon">üíâ</span>2.2 DI —Å Dishka</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 3: –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ</div>
                    <a href="part3_faststream.html" class="nav-link"><span class="nav-link-icon">üì®</span>3.1 RabbitMQ + Faststream</a>
                    <a href="part3_redis.html" class="nav-link"><span class="nav-link-icon">‚ö°</span>3.2 Redis Patterns</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 4: –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å</div>
                    <a href="part4_testing.html" class="nav-link"><span class="nav-link-icon">üß™</span>4.1 Advanced Testing</a>
                    <a href="part4_resiliency.html" class="nav-link"><span class="nav-link-icon">üõ°Ô∏è</span>4.2 Resiliency</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 5: Observability</div>
                    <a href="part5_logging.html" class="nav-link"><span class="nav-link-icon">üìù</span>5.1 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
                    <a href="part5_clickhouse.html" class="nav-link"><span class="nav-link-icon">üìà</span>5.2 ClickHouse</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 6: Production</div>
                    <a href="part6_migrations.html" class="nav-link"><span class="nav-link-icon">üîÄ</span>6.1 Zero-Downtime</a>
                    <a href="part6_quality.html" class="nav-link"><span class="nav-link-icon">‚úÖ</span>6.2 Code Quality</a>
                    <a href="part6_django.html" class="nav-link active"><span class="nav-link-icon">üîó</span>6.3 Django Admin</a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="breadcrumb">
                    <a href="index.html">ScaleTrade</a>
                    <span>/</span>
                    <span>–ß–∞—Å—Ç—å 6</span>
                    <span>/</span>
                    <span>6.3 Django Admin</span>
                </div>
            </header>

            <div class="page-content">
                <h1>–ú–æ–¥—É–ª—å 6.3: Django Admin Integration</h1>
                <p class="lead">
                    –ò—Å–ø–æ–ª—å–∑—É–µ–º Django Admin –∫–∞–∫ –≥–æ—Ç–æ–≤—É—é –∞–¥–º–∏–Ω–∫—É –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
                </p>

                <div class="info-box tip">
                    <div class="info-box-title">üí° –ó–∞—á–µ–º Django Admin?</div>
                    <p>
                        Django Admin ‚Äî –º–æ—â–Ω—ã–π –≥–æ—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π.
                        –í–º–µ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–≤–æ–µ–π –∞–¥–º–∏–Ω–∫–∏ (–Ω–µ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç—ã), 
                        –ø–æ–¥–∫–ª—é—á–∞–µ–º Django –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î (—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã).
                    </p>
                </div>

                <h2>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–¥–Ω–∞ –ë–î</h2>

<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      PostgreSQL                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   orders    ‚îÇ    users    ‚îÇ   wallets    ‚îÇ   django_*  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                                          ‚ñ≤
         ‚îÇ SQLAlchemy (async)                       ‚îÇ Django ORM (sync)
         ‚îÇ                                          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Litestar API  ‚îÇ                      ‚îÇ    Django Admin     ‚îÇ
‚îÇ   (main app)    ‚îÇ                      ‚îÇ   (admin panel)     ‚îÇ
‚îÇ   port 8000     ‚îÇ                      ‚îÇ    port 8001        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>

                <h2>Django –ø—Ä–æ–µ–∫—Ç: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</h2>

<pre><code><span class="comment"># admin_panel/</span>
admin_panel/
‚îú‚îÄ‚îÄ admin_panel/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py
‚îú‚îÄ‚îÄ scaletrade_admin/       <span class="comment"># Django app</span>
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ admin.py            <span class="comment"># Admin –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</span>
‚îÇ   ‚îú‚îÄ‚îÄ apps.py
‚îÇ   ‚îî‚îÄ‚îÄ models.py           <span class="comment"># managed=False –º–æ–¥–µ–ª–∏</span>
‚îî‚îÄ‚îÄ manage.py</code></pre>

                <h2>Settings: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î</h2>

<pre><code><span class="comment"># admin_panel/admin_panel/settings.py</span>
<span class="keyword">import</span> os
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path

BASE_DIR = Path(__file__).resolve().parent.parent

SECRET_KEY = os.environ[<span class="string">"DJANGO_SECRET_KEY"</span>]
DEBUG = os.environ.get(<span class="string">"DEBUG"</span>, <span class="string">"false"</span>).lower() == <span class="string">"true"</span>
ALLOWED_HOSTS = [<span class="string">"*"</span>]

INSTALLED_APPS = [
    <span class="string">"django.contrib.admin"</span>,
    <span class="string">"django.contrib.auth"</span>,
    <span class="string">"django.contrib.contenttypes"</span>,
    <span class="string">"django.contrib.sessions"</span>,
    <span class="string">"django.contrib.messages"</span>,
    <span class="string">"django.contrib.staticfiles"</span>,
    <span class="comment"># –ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
    <span class="string">"scaletrade_admin"</span>,
]

MIDDLEWARE = [
    <span class="string">"django.middleware.security.SecurityMiddleware"</span>,
    <span class="string">"django.contrib.sessions.middleware.SessionMiddleware"</span>,
    <span class="string">"django.middleware.common.CommonMiddleware"</span>,
    <span class="string">"django.middleware.csrf.CsrfViewMiddleware"</span>,
    <span class="string">"django.contrib.auth.middleware.AuthenticationMiddleware"</span>,
    <span class="string">"django.contrib.messages.middleware.MessageMiddleware"</span>,
]

<span class="comment"># –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î ScaleTrade</span>
DATABASES = {
    <span class="string">"default"</span>: {
        <span class="string">"ENGINE"</span>: <span class="string">"django.db.backends.postgresql"</span>,
        <span class="string">"NAME"</span>: os.environ[<span class="string">"POSTGRES_DB"</span>],
        <span class="string">"USER"</span>: os.environ[<span class="string">"POSTGRES_USER"</span>],
        <span class="string">"PASSWORD"</span>: os.environ[<span class="string">"POSTGRES_PASSWORD"</span>],
        <span class="string">"HOST"</span>: os.environ[<span class="string">"POSTGRES_HOST"</span>],
        <span class="string">"PORT"</span>: os.environ.get(<span class="string">"POSTGRES_PORT"</span>, <span class="string">"5432"</span>),
    }
}

<span class="comment"># Static files</span>
STATIC_URL = <span class="string">"/static/"</span>
STATIC_ROOT = BASE_DIR / <span class="string">"staticfiles"</span></code></pre>

                <h2>Models: managed=False</h2>

                <p>
                    <code>managed = False</code> –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Django –ù–ï –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/–º–µ–Ω—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã.
                    –ú–æ–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö.
                </p>

<pre><code><span class="comment"># admin_panel/scaletrade_admin/models.py</span>
<span class="keyword">from</span> django.db <span class="keyword">import</span> models
<span class="keyword">import</span> uuid


<span class="keyword">class</span> <span class="class-name">User</span>(models.Model):
    <span class="string">"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ScaleTrade (read-only —Ç–∞–±–ª–∏—Ü–∞)."""</span>
    
    id = models.BigAutoField(primary_key=<span class="keyword">True</span>)
    email = models.EmailField(unique=<span class="keyword">True</span>)
    hashed_password = models.CharField(max_length=<span class="number">255</span>)
    is_active = models.BooleanField(default=<span class="keyword">True</span>)
    is_verified = models.BooleanField(default=<span class="keyword">False</span>)
    created_at = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)
    updated_at = models.DateTimeField(auto_now=<span class="keyword">True</span>)
    
    <span class="keyword">class</span> <span class="class-name">Meta</span>:
        managed = <span class="keyword">False</span>  <span class="comment"># Django –ù–ï —É–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ–π</span>
        db_table = <span class="string">"users"</span>
        verbose_name = <span class="string">"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"</span>
        verbose_name_plural = <span class="string">"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"</span>
    
    <span class="keyword">def</span> <span class="function">__str__</span>(self) -> <span class="type">str</span>:
        <span class="keyword">return</span> self.email


<span class="keyword">class</span> <span class="class-name">Order</span>(models.Model):
    <span class="string">"""–û—Ä–¥–µ—Ä ScaleTrade."""</span>
    
    <span class="keyword">class</span> <span class="class-name">Side</span>(models.TextChoices):
        BUY = <span class="string">"buy"</span>, <span class="string">"–ü–æ–∫—É–ø–∫–∞"</span>
        SELL = <span class="string">"sell"</span>, <span class="string">"–ü—Ä–æ–¥–∞–∂–∞"</span>
    
    <span class="keyword">class</span> <span class="class-name">Status</span>(models.TextChoices):
        PENDING = <span class="string">"pending"</span>, <span class="string">"–û–∂–∏–¥–∞–µ—Ç"</span>
        FILLED = <span class="string">"filled"</span>, <span class="string">"–ò—Å–ø–æ–ª–Ω–µ–Ω"</span>
        CANCELLED = <span class="string">"cancelled"</span>, <span class="string">"–û—Ç–º–µ–Ω—ë–Ω"</span>
        REJECTED = <span class="string">"rejected"</span>, <span class="string">"–û—Ç–∫–ª–æ–Ω—ë–Ω"</span>
    
    id = models.UUIDField(primary_key=<span class="keyword">True</span>, default=uuid.uuid4)
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name=<span class="string">"orders"</span>,
        db_column=<span class="string">"user_id"</span>,
    )
    symbol = models.CharField(max_length=<span class="number">20</span>)
    side = models.CharField(max_length=<span class="number">4</span>, choices=Side.choices)
    quantity = models.DecimalField(max_digits=<span class="number">18</span>, decimal_places=<span class="number">8</span>)
    price = models.DecimalField(max_digits=<span class="number">18</span>, decimal_places=<span class="number">2</span>)
    status = models.CharField(
        max_length=<span class="number">10</span>,
        choices=Status.choices,
        default=Status.PENDING,
    )
    created_at = models.DateTimeField()
    filled_at = models.DateTimeField(null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>)
    
    <span class="keyword">class</span> <span class="class-name">Meta</span>:
        managed = <span class="keyword">False</span>
        db_table = <span class="string">"orders"</span>
        ordering = [<span class="string">"-created_at"</span>]
        verbose_name = <span class="string">"–û—Ä–¥–µ—Ä"</span>
        verbose_name_plural = <span class="string">"–û—Ä–¥–µ—Ä—ã"</span>
    
    <span class="keyword">def</span> <span class="function">__str__</span>(self) -> <span class="type">str</span>:
        <span class="keyword">return</span> f<span class="string">"{self.side.upper()} {self.symbol} @ {self.price}"</span>
    
    <span class="decorator">@property</span>
    <span class="keyword">def</span> <span class="function">total_value</span>(self):
        <span class="keyword">return</span> self.quantity * self.price


<span class="keyword">class</span> <span class="class-name">Wallet</span>(models.Model):
    <span class="string">"""–ö–æ—à–µ–ª—ë–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""</span>
    
    id = models.BigAutoField(primary_key=<span class="keyword">True</span>)
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name=<span class="string">"wallets"</span>,
        db_column=<span class="string">"user_id"</span>,
    )
    currency = models.CharField(max_length=<span class="number">10</span>)
    balance = models.DecimalField(max_digits=<span class="number">18</span>, decimal_places=<span class="number">8</span>)
    locked_balance = models.DecimalField(max_digits=<span class="number">18</span>, decimal_places=<span class="number">8</span>)
    updated_at = models.DateTimeField(auto_now=<span class="keyword">True</span>)
    
    <span class="keyword">class</span> <span class="class-name">Meta</span>:
        managed = <span class="keyword">False</span>
        db_table = <span class="string">"wallets"</span>
        unique_together = [(<span class="string">"user"</span>, <span class="string">"currency"</span>)]
        verbose_name = <span class="string">"–ö–æ—à–µ–ª—ë–∫"</span>
        verbose_name_plural = <span class="string">"–ö–æ—à–µ–ª—å–∫–∏"</span>
    
    <span class="keyword">def</span> <span class="function">__str__</span>(self) -> <span class="type">str</span>:
        <span class="keyword">return</span> f<span class="string">"{self.user.email} - {self.currency}"</span></code></pre>

                <h2>Admin: –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è</h2>

<pre><code><span class="comment"># admin_panel/scaletrade_admin/admin.py</span>
<span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin
<span class="keyword">from</span> django.utils.html <span class="keyword">import</span> format_html

<span class="keyword">from</span> .models <span class="keyword">import</span> User, Order, Wallet


<span class="decorator">@admin.register</span>(User)
<span class="keyword">class</span> <span class="class-name">UserAdmin</span>(admin.ModelAdmin):
    <span class="string">"""Admin –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."""</span>
    
    list_display = [
        <span class="string">"id"</span>, <span class="string">"email"</span>, <span class="string">"is_active"</span>, <span class="string">"is_verified"</span>, 
        <span class="string">"orders_count"</span>, <span class="string">"created_at"</span>
    ]
    list_filter = [<span class="string">"is_active"</span>, <span class="string">"is_verified"</span>, <span class="string">"created_at"</span>]
    search_fields = [<span class="string">"email"</span>]
    readonly_fields = [<span class="string">"created_at"</span>, <span class="string">"updated_at"</span>, <span class="string">"hashed_password"</span>]
    ordering = [<span class="string">"-created_at"</span>]
    
    <span class="keyword">def</span> <span class="function">orders_count</span>(self, obj):
        <span class="keyword">return</span> obj.orders.count()
    orders_count.short_description = <span class="string">"–û—Ä–¥–µ—Ä–æ–≤"</span>
    
    <span class="keyword">def</span> <span class="function">has_delete_permission</span>(self, request, obj=<span class="keyword">None</span>):
        <span class="comment"># –ó–∞–ø—Ä–µ—â–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –∞–¥–º–∏–Ω–∫–∏</span>
        <span class="keyword">return False</span>


<span class="keyword">class</span> <span class="class-name">OrderStatusFilter</span>(admin.SimpleListFilter):
    <span class="string">"""–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –æ—Ä–¥–µ—Ä–∞."""</span>
    
    title = <span class="string">"–°—Ç–∞—Ç—É—Å"</span>
    parameter_name = <span class="string">"status"</span>
    
    <span class="keyword">def</span> <span class="function">lookups</span>(self, request, model_admin):
        <span class="keyword">return</span> Order.Status.choices
    
    <span class="keyword">def</span> <span class="function">queryset</span>(self, request, queryset):
        <span class="keyword">if</span> self.value():
            <span class="keyword">return</span> queryset.filter(status=self.value())
        <span class="keyword">return</span> queryset


<span class="decorator">@admin.register</span>(Order)
<span class="keyword">class</span> <span class="class-name">OrderAdmin</span>(admin.ModelAdmin):
    <span class="string">"""Admin –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤."""</span>
    
    list_display = [
        <span class="string">"id_short"</span>, <span class="string">"user_email"</span>, <span class="string">"symbol"</span>, 
        <span class="string">"side_badge"</span>, <span class="string">"quantity"</span>, <span class="string">"price"</span>,
        <span class="string">"status_badge"</span>, <span class="string">"created_at"</span>
    ]
    list_filter = [OrderStatusFilter, <span class="string">"side"</span>, <span class="string">"symbol"</span>, <span class="string">"created_at"</span>]
    search_fields = [<span class="string">"id"</span>, <span class="string">"user__email"</span>, <span class="string">"symbol"</span>]
    readonly_fields = [
        <span class="string">"id"</span>, <span class="string">"user"</span>, <span class="string">"symbol"</span>, <span class="string">"side"</span>, 
        <span class="string">"quantity"</span>, <span class="string">"price"</span>, <span class="string">"created_at"</span>, <span class="string">"filled_at"</span>
    ]
    ordering = [<span class="string">"-created_at"</span>]
    list_per_page = <span class="number">50</span>
    
    <span class="keyword">def</span> <span class="function">id_short</span>(self, obj):
        <span class="keyword">return</span> <span class="type">str</span>(obj.id)[:<span class="number">8</span>]
    id_short.short_description = <span class="string">"ID"</span>
    
    <span class="keyword">def</span> <span class="function">user_email</span>(self, obj):
        <span class="keyword">return</span> obj.user.email
    user_email.short_description = <span class="string">"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"</span>
    
    <span class="keyword">def</span> <span class="function">side_badge</span>(self, obj):
        colors = {<span class="string">"buy"</span>: <span class="string">"#22c55e"</span>, <span class="string">"sell"</span>: <span class="string">"#ef4444"</span>}
        color = colors.get(obj.side, <span class="string">"#888"</span>)
        <span class="keyword">return</span> format_html(
            <span class="string">'&lt;span style="color: {}; font-weight: bold;"&gt;{}&lt;/span&gt;'</span>,
            color,
            obj.get_side_display(),
        )
    side_badge.short_description = <span class="string">"–°—Ç–æ—Ä–æ–Ω–∞"</span>
    
    <span class="keyword">def</span> <span class="function">status_badge</span>(self, obj):
        colors = {
            <span class="string">"pending"</span>: <span class="string">"#f59e0b"</span>,
            <span class="string">"filled"</span>: <span class="string">"#22c55e"</span>,
            <span class="string">"cancelled"</span>: <span class="string">"#6b7280"</span>,
            <span class="string">"rejected"</span>: <span class="string">"#ef4444"</span>,
        }
        color = colors.get(obj.status, <span class="string">"#888"</span>)
        <span class="keyword">return</span> format_html(
            <span class="string">'&lt;span style="background: {}; color: white; '
            'padding: 2px 8px; border-radius: 4px;"&gt;{}&lt;/span&gt;'</span>,
            color,
            obj.get_status_display(),
        )
    status_badge.short_description = <span class="string">"–°—Ç–∞—Ç—É—Å"</span>
    
    <span class="keyword">def</span> <span class="function">has_add_permission</span>(self, request):
        <span class="comment"># –û—Ä–¥–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API</span>
        <span class="keyword">return False</span>
    
    <span class="keyword">def</span> <span class="function">has_delete_permission</span>(self, request, obj=<span class="keyword">None</span>):
        <span class="keyword">return False</span>


<span class="decorator">@admin.register</span>(Wallet)
<span class="keyword">class</span> <span class="class-name">WalletAdmin</span>(admin.ModelAdmin):
    <span class="string">"""Admin –¥–ª—è –∫–æ—à–µ–ª—å–∫–æ–≤."""</span>
    
    list_display = [
        <span class="string">"id"</span>, <span class="string">"user_email"</span>, <span class="string">"currency"</span>, 
        <span class="string">"balance"</span>, <span class="string">"locked_balance"</span>, <span class="string">"available"</span>
    ]
    list_filter = [<span class="string">"currency"</span>]
    search_fields = [<span class="string">"user__email"</span>, <span class="string">"currency"</span>]
    readonly_fields = [<span class="string">"user"</span>, <span class="string">"currency"</span>, <span class="string">"updated_at"</span>]
    
    <span class="keyword">def</span> <span class="function">user_email</span>(self, obj):
        <span class="keyword">return</span> obj.user.email
    user_email.short_description = <span class="string">"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"</span>
    
    <span class="keyword">def</span> <span class="function">available</span>(self, obj):
        <span class="keyword">return</span> obj.balance - obj.locked_balance
    available.short_description = <span class="string">"–î–æ—Å—Ç—É–ø–Ω–æ"</span></code></pre>

                <h2>–ó–∞–ø—É—Å–∫ Django Admin</h2>

<pre><code><span class="comment"># Dockerfile.admin</span>
FROM python:3.11-slim

WORKDIR /app

COPY admin_panel/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY admin_panel/ .

<span class="comment"># Collect static</span>
RUN python manage.py collectstatic --noinput

<span class="comment"># –°–æ–∑–¥–∞—ë–º –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è django_* —Ç–∞–±–ª–∏—Ü</span>
RUN python manage.py migrate --run-syncdb

EXPOSE 8001

CMD [<span class="string">"gunicorn"</span>, <span class="string">"admin_panel.wsgi:application"</span>, <span class="string">"-b"</span>, <span class="string">"0.0.0.0:8001"</span>]</code></pre>

<pre><code><span class="comment"># docker-compose.yml (–¥–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å)</span>
services:
  admin:
    build:
      context: .
      dockerfile: Dockerfile.admin
    ports:
      - <span class="string">"8001:8001"</span>
    environment:
      - DJANGO_SECRET_KEY=${DJANGO_SECRET_KEY}
      - POSTGRES_HOST=postgres
      - POSTGRES_DB=scaletrade
      - POSTGRES_USER=scaletrade
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    depends_on:
      - postgres</code></pre>

                <div class="info-box warning">
                    <div class="info-box-title">‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
                    <ul>
                        <li>Django Admin –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞ VPN –∏–ª–∏ IP whitelist</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ DB user —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏</li>
                        <li>–í–∫–ª—é—á–∏ audit log –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –∞–¥–º–∏–Ω–∫–µ</li>
                        <li>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ (django-otp)</li>
                    </ul>
                </div>

                <div class="task-box">
                    <h4>üìã –ó–∞–¥–∞–Ω–∏–µ</h4>
                    <ul class="task-list">
                        <li>–°–æ–∑–¥–∞–π Django –ø—Ä–æ–µ–∫—Ç —Å managed=False –º–æ–¥–µ–ª—è–º–∏</li>
                        <li>–ù–∞—Å—Ç—Ä–æ–π ModelAdmin –¥–ª—è User, Order, Wallet</li>
                        <li>–î–æ–±–∞–≤—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ badges</li>
                        <li>–ó–∞–ø—É—Å—Ç–∏ Django Admin –≤ Docker</li>
                        <li>–ù–∞—Å—Ç—Ä–æ–π –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (readonly –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π)</li>
                    </ul>
                </div>

                <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
                
                <p>
                    –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å ScaleTrade! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –∑–Ω–∞–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
                    production-ready backend —Å–∏—Å—Ç–µ–º –Ω–∞ Python.
                </p>

                <h2>ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ Django</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>1. –°–∏–≥–Ω–∞–ª—ã (Signals)</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–°–∏–≥–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ! –ï—Å–ª–∏ –≤ <code>post_save</code> –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ email, —Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –±—É–¥–µ—Ç –≤–∏—Å–µ—Ç—å, –ø–æ–∫–∞ SMTP —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç. –ü–ª—é—Å, —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–∑–º–∞–∑—ã–≤–∞—é—Ç –ª–æ–≥–∏–∫—É –ø–æ –ø—Ä–æ–µ–∫—Ç—É, –¥–µ–ª–∞—è –∫–æ–¥ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–º ("–Ø –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª —é–∑–µ—Ä–∞, –ø–æ—á–µ–º—É —É–ø–∞–ª Celery?").</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>2. N+1 –≤ –ê–¥–º–∏–Ω–∫–µ</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è –∏–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ <code>list_display</code> –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É N+1. –ù–∞ –∫–∞–∂–¥—ã–π —Ä—è–¥ –∞–¥–º–∏–Ω–∫–∞ –¥–µ–ª–∞–µ—Ç –Ω–æ–≤—ã–π SELECT. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>list_select_related</code> –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ <code>get_queryset</code>.</p>
                        </div>
                    </div>
                </div>

                <h2>üí° –õ–∞–π—Ñ—Ö–∞–∫–∏</h2>
                <ul>
                    <li><strong>Django Ninja:</strong> –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω API –Ω–∞ Django, –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ DRF. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Django Ninja (Pydantic + Async support). –û–Ω –±—ã—Å—Ç—Ä–µ–µ, –ø–æ–Ω—è—Ç–Ω–µ–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–µ–µ.</li>
                    <li><strong>django-debug-toolbar:</strong> –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–µ-—Ñ–∞–∫—Ç–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã, –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª—ã.</li>
                    <li><strong>Constraint Validation:</strong> –í—Å–µ–≥–¥–∞ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –º–æ–¥–µ–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (Constraint). Django –≤–∞–ª–∏–¥–∞—Ü–∏—è (<code>clean()</code>) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—ã/DRF, –Ω–æ –Ω–µ –ø—Ä–∏ <code>User.objects.create()</code>.</li>
                </ul>

                <div class="nav-footer">
                    <a href="part6_quality.html">
                        <div>
                            <div class="nav-label">–ù–∞–∑–∞–¥</div>
                            <div class="nav-title">‚Üê 6.2 Code Quality</div>
                        </div>
                    </a>
                    <a href="index.html">
                        <div>
                            <div class="nav-label">–ö –Ω–∞—á–∞–ª—É</div>
                            <div class="nav-title">üè† –ì–ª–∞–≤–Ω–∞—è ‚Üí</div>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
