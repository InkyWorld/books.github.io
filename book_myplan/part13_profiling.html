<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13.1 Profiling ‚Äî ScaleTrade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="book-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üìà</div>
                    <span>ScaleTrade</span>
                </a>
            </div>
            <nav class="sidebar-nav">
    <div class="nav-section">
        <div class="nav-section-title">Intro</div>
        <a href="index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="setup.html" class="nav-link">üõ† Setup</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 0: Fundamentals</div>
        <a href="part0_internals.html" class="nav-link">0.1 Internals</a>
        <a href="part0_networking.html" class="nav-link">0.2 Networking</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 1: Postgres</div>
        <a href="part1_schema.html" class="nav-link">1.1 Schema</a>
        <a href="part1_indexes.html" class="nav-link">1.2 Indexes</a>
        <a href="part1_transactions.html" class="nav-link">1.3 Transactions</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 2: Litestar</div>
        <a href="part2_litestar.html" class="nav-link">2.1 Framework</a>
        <a href="part2_dishka.html" class="nav-link">2.2 DI (Dishka)</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 3: Brokers</div>
        <a href="part3_redis.html" class="nav-link">3.1 Redis</a>
        <a href="part3_faststream.html" class="nav-link">3.2 FastStream</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 4: Quality</div>
        <a href="part4_testing.html" class="nav-link">4.1 Pytest</a>
        <a href="part4_resiliency.html" class="nav-link">4.2 Resilience</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 5: Observability</div>
        <a href="part5_clickhouse.html" class="nav-link">5.1 Clickhouse</a>
        <a href="part5_logging.html" class="nav-link">5.2 Structured Logs</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 6: Django</div>
        <a href="part6_django.html" class="nav-link">6.1 ORM</a>
        <a href="part6_migrations.html" class="nav-link">6.2 Migrations</a>
        <a href="part6_quality.html" class="nav-link">6.3 Quality</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 7: Microservices</div>
        <a href="part7_grpc.html" class="nav-link">7.1 gRPC</a>
        <a href="part7_graphql.html" class="nav-link">7.2 GraphQL</a>
        <a href="part7_federation.html" class="nav-link">7.3 Federation</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 8: Async</div>
        <a href="part8_asyncio.html" class="nav-link">8.1 Asyncio</a>
        <a href="part8_celery.html" class="nav-link">8.2 Celery</a>
        <a href="part8_dramatiq.html" class="nav-link">8.3 Dramatiq</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 9: API</div>
        <a href="part9_restdesign.html" class="nav-link">9.1 REST Design</a>
        <a href="part9_idempotency.html" class="nav-link">9.2 Idempotency</a>
        <a href="part9_openapi.html" class="nav-link">9.3 OpenAPI</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 10: Culture</div>
        <a href="part10_git.html" class="nav-link">10.1 Git</a>
        <a href="part10_commits.html" class="nav-link">10.2 Commits</a>
        <a href="part10_codereview.html" class="nav-link">10.3 Post-Review</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 11: Security</div>
        <a href="part11_oauth.html" class="nav-link">11.1 OAuth2</a>
        <a href="part11_vault.html" class="nav-link">11.2 Vault</a>
        <a href="part11_owasp.html" class="nav-link">11.3 OWASP</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 12: Kubernetes</div>
        <a href="part12_kubernetes.html" class="nav-link">12.1 K8s Basics</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 13: High Load</div>
        <a href="part13_profiling.html" class="nav-link active">13.1 Profiling</a>
        <a href="part13_caching.html" class="nav-link">13.2 Caching</a>
        <a href="part13_loadbalancing.html" class="nav-link">13.3 Load Balancing</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 14: ML Ops</div>
        <a href="part14_mlflow.html" class="nav-link">14.1 MLflow</a>
        <a href="part14_embeddings.html" class="nav-link">14.2 Embeddings</a>
        <a href="part14_llm.html" class="nav-link">14.3 LLM</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 15: Debugging</div>
        <a href="part15_debugging.html" class="nav-link">15.1 Debugging</a>
        <a href="part15_postmortem.html" class="nav-link">15.2 Postmortem</a>
        <a href="part15_chaos.html" class="nav-link">15.3 Chaos Eng</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 16: DB Advanced</div>
        <a href="part16_indexes.html" class="nav-link">16.1 Indexes Deep</a>
        <a href="part16_isolation.html" class="nav-link">16.2 Isolation</a>
        <a href="part16_sharding.html" class="nav-link">16.3 Sharding</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 17: System Design</div>
        <a href="part17_circuit.html" class="nav-link">17.1 Circuit Breaker</a>
        <a href="part17_ratelimit.html" class="nav-link">17.2 Rate Limit</a>
        <a href="part17_distlock.html" class="nav-link">17.3 Dist Lock</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 18: Soft Skills</div>
        <a href="part18_estimation.html" class="nav-link">18.1 Estimation</a>
        <a href="part18_burnout.html" class="nav-link">18.2 Burnout</a>
        <a href="part18_interview.html" class="nav-link">18.3 Interview</a>
    </div>
</nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="breadcrumb">
                    <a href="index.html">ScaleTrade</a>
                    <span>/</span>
                    <span>–ß–∞—Å—Ç—å 13</span>
                    <span>/</span>
                    <span>13.1 Profiling</span>
                </div>
            </header>

            <div class="page-content">
                <h1>–ú–æ–¥—É–ª—å 13.1: –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</h1>
                <p class="lead">"–ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚Äî –∫–æ—Ä–µ–Ω—å –≤—Å–µ—Ö –∑–æ–ª". –ù–æ –∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –≥–æ—Ä–∏—Ç, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ. –£—á–∏–º—Å—è –∏—Å–∫–∞—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞.</p>

                <h2>–ß—Ç–æ –º—ã –∏—â–µ–º? (Bottlenecks)</h2>
                <ul>
                    <li><strong>CPU Bound:</strong> –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 100%. –°–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è.</li>
                    <li><strong>I/O Bound:</strong> –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç, –∂–¥—ë–º —Å–µ—Ç—å –∏–ª–∏ –¥–∏—Å–∫. –ë–î –∑–∞–ø—Ä–æ—Å—ã, –≤–Ω–µ—à–Ω–∏–µ API, —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤.</li>
                    <li><strong>Memory Bound:</strong> –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (Memory Leaks), —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã. –í–µ–¥—ë—Ç –∫ —Å–≤–æ–ø—É –∏ OOMKill.</li>
                </ul>

                <h2>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è Python</h2>

                <h3>1. cProfile + SnakeViz</h3>
                <p>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –∏ –≤—Ä–µ–º—è.</p>
                <div class="code-block">
                    <pre><code>python -m cProfile -o output.prof myscript.py
pip install snakeviz
snakeviz output.prof</code></pre>
                </div>
                <p><em>–ú–∏–Ω—É—Å:</em> –ó–∞–º–µ–¥–ª—è–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞. –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.</p>

                <h3>2. py-spy (Sampling Profiler)</h3>
                <p>–ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞. –†–∞–±–æ—Ç–∞–µ—Ç —Å <strong>—É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–º</strong> –ø—Ä–æ—Ü–µ—Å—Å–æ–º –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ—á—Ç–∏ –±–µ–∑ –æ–≤–µ—Ä—Ö–µ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–≥–∏—é Linux eBPF/ptrace.</p>
                <div class="code-block">
                    <pre><code># Top-like live view
py-spy top --pid 12345

# Flamegraph generation
py-spy record -o profile.svg --pid 12345</code></pre>
                </div>
                <p><em>–ü–ª—é—Å:</em> –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –ø—Ä–æ–¥–µ.</p>

                <h3>3. Austin</h3>
                <p>–ï—â–µ –æ–¥–∏–Ω –º–æ—â–Ω—ã–π —Å—ç–º–ø–ª–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä, –æ—Ç–ª–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å VS Code.</p>

                <h2>SQL Profiling (APM)</h2>
                <p>–ß–∞—Å—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –∫–æ–¥–µ, –∞ –≤ –±–∞–∑–µ. N+1 –ø—Ä–æ–±–ª–µ–º–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã.</p>
                <ul>
                    <li><strong>Django Debug Toolbar:</strong> –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</li>
                    <li><strong>Silk:</strong> –ñ–∏–≤–æ–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä –¥–ª—è Django, –ø–∏—à–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î.</li>
                    <li><strong>Sentry / Datadog / New Relic:</strong> APM (Application Performance Monitoring) —Å–∏—Å—Ç–µ–º—ã. –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç —Ç—Ä–µ–π—Å—ã (Traces) –∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–∞–∫–æ–π —Å–ø–∞–Ω (Span) —Ç–æ—Ä–º–æ–∑–∏—Ç (–ë–î, Redis, –≤–Ω–µ—à–Ω–∏–π API).</li>
                </ul>

                <h2>ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>1. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (Average) –ª–∂—ë—Ç</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ average response time. –ï—Å–ª–∏ 99 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ—à–ª–∏ –∑–∞ 1–º—Å, –∞ –æ–¥–∏–Ω –∑–∞ 100—Å (—Ç–∞–π–º–∞—É—Ç), —Å—Ä–µ–¥–Ω–µ–µ –±—É–¥–µ—Ç 1—Å. –≠—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ 1% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç—Ä–∞–¥–∞–µ—Ç. –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏: <strong>p95, p99</strong>.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>2. –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ `cProfile` –∏–ª–∏ `Django Debug Toolbar` –¥–æ–±–∞–≤–ª—è—é—Ç –æ–≥—Ä–æ–º–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥. –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥—Ä—É–∑–∏—Ç—Å—è 500–º—Å —Å —Ç—É–ª–±–∞—Ä–æ–º, —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–Ω–∞ –≥—Ä—É–∑–∏—Ç—Å—è 500–º—Å –±–µ–∑ –Ω–µ–≥–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Sampling Profilers (py-spy) –¥–ª—è —á–µ—Å—Ç–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π.</p>
                        </div>
                    </div>
                </div>

                <h2>üí° –õ–∞–π—Ñ—Ö–∞–∫–∏</h2>
                <ul>
                    <li><strong>Memray:</strong> –õ—É—á—à–∏–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä –ø–∞–º—è—Ç–∏ –¥–ª—è Python. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ "—Å–∫–æ–ª—å–∫–æ", –Ω–æ –∏ "–∫—Ç–æ" (–∫–∞–∫–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞) –≤—ã–¥–µ–ª–∏–ª –ø–∞–º—è—Ç—å. –£–º–µ–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å Flamegraphs –¥–ª—è –ø–∞–º—è—Ç–∏.</li>
                    <li><strong>VizTracer:</strong> –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python –∫–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å Chrome Tracing (chrome://tracing). –í—ã –≤–∏–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω–µ, –∫–∞–∫ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞.</li>
                    <li><strong>Timeit:</strong> –î–ª—è –º–∏–∫—Ä–æ-–±–µ–Ω—á–º–∞—Ä–∫–æ–≤ (–∫–∞–∫–æ–π —Å–ø–æ—Å–æ–± –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –±—ã—Å—Ç—Ä–µ–µ) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å: <code>python -m timeit '"-".join(str(n) for n in range(100))'</code>.</li>
                </ul>

                <div class="task-box">
                    <h4>üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞</h4>
                    <ul class="task-list">
                        <li>–°–Ω–∏–º–∏ FlameGraph —Å —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ <code>py-spy record</code></li>
                        <li>–ù–∞–π–¥–∏ —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é <code>memray</code> (–Ω–∞–ø–∏—à–∏ leaky script)</li>
                        <li>–ù–∞—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫—É —Ç—Ä–µ–π—Å–æ–≤ –≤ Jaeger –∏–ª–∏ Sentry</li>
                        <li>–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π N+1 –∑–∞–ø—Ä–æ—Å, –Ω–∞–π–¥–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ Django Debug Toolbar</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>
</body>
</html>