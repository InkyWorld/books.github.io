<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13.2 Caching ‚Äî ScaleTrade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="book-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üìà</div>
                    <span>ScaleTrade</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">–í–≤–µ–¥–µ–Ω–∏–µ</div>
                    <a href="index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">–ß–∞—Å—Ç—å 13: Performance</div>
                    <a href="part13_profiling.html" class="nav-link">13.1 Profiling</a>
                    <a href="part13_caching.html" class="nav-link active">13.2 Caching</a>
                    <a href="part13_loadbalancing.html" class="nav-link">13.3 Load Balancing</a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="breadcrumb">
                    <a href="index.html">ScaleTrade</a>
                    <span>/</span>
                    <span>–ß–∞—Å—Ç—å 13</span>
                    <span>/</span>
                    <span>13.2 Caching</span>
                </div>
            </header>

            <div class="page-content">
                <h1>–ú–æ–¥—É–ª—å 13.2: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
                <p class="lead">"There are only two hard things in Computer Science: cache invalidation and naming things." ‚Äî Phil Karlton.</p>

                <h2>–ì–¥–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å?</h2>
                <ol>
                    <li><strong>–ë—Ä–∞—É–∑–µ—Ä (Client Side):</strong> HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ <code>Cache-Control</code>, <code>ETag</code>. –°–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –∫—ç—à ‚Äî –∑–∞–ø—Ä–æ—Å –¥–∞–∂–µ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.</li>
                    <li><strong>CDN (Content Delivery Network):</strong> Cloudflare, AWS CloudFront. –ö—ç—à–∏—Ä—É—é—Ç —Å—Ç–∞—Ç–∏–∫—É –∏ –æ—Ç–≤–µ—Ç—ã API –Ω–∞ "–∫—Ä–∞—é" (edge) —Å–µ—Ç–∏, –±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.</li>
                    <li><strong>API Gateway / Load Balancer:</strong> Nginx –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –±—ç–∫–µ–Ω–¥–∞.</li>
                    <li><strong>Application Cache:</strong> Redis / Memcached. –•—Ä–∞–Ω–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.</li>
                    <li><strong>Database Cache:</strong> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –±—É—Ñ–µ—Ä—ã –ë–î.</li>
                </ol>

                <h2>–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

                <h3>1. Cache-Aside (Lazy Loading)</h3>
                <p>–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω.</p>
                <div class="code-block">
                    <pre><code>def get_user(user_id):
    # 1. –ß–∏—Ç–∞–µ–º –∏–∑ –∫—ç—à–∞
    user = cache.get(user_id)
    if user:
        return user

    # 2. –ï—Å–ª–∏ –Ω–µ—Ç (Cache Miss), –∏–¥–µ–º –≤ –ë–î
    user = db.get_user(user_id)

    # 3. –ü–∏—à–µ–º –≤ –∫—ç—à
    cache.set(user_id, user, timeout=600)
    return user</code></pre>
                </div>

                <h3>2. Write-Through</h3>
                <p>–ü–∏—à–µ–º –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –≤ –ë–î, –∏ –≤ –∫—ç—à. –ö—ç—à –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω, –Ω–æ –∑–∞–ø–∏—Å—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ.</p>

                <h3>3. Write-Behind (Write-Back)</h3>
                <p>–ü–∏—à–µ–º —Ç–æ–ª—å–∫–æ –≤ –∫—ç—à, –∞ —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î. –û–ø–∞—Å–Ω–æ –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∫—ç—à —É–ø–∞–¥–µ—Ç –¥–æ —Å–±—Ä–æ—Å–∞), –Ω–æ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ.</p>


                <h2>ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>1. Hot Keys</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ï—Å–ª–∏ –æ–¥–∏–Ω –∫–ª—é—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞" –∏–ª–∏ "–ø—Ä–æ—Ñ–∏–ª—å –î–∂–∞—Å—Ç–∏–Ω–∞ –ë–∏–±–µ—Ä–∞") –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –º–∏–ª–ª–∏–æ–Ω —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É, –æ–¥–∏–Ω —à–∞—Ä–¥ Redis –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è (CPU 100%). –†–µ—à–µ–Ω–∏–µ: –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∞—Ä–¥–∞—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Local Cache (in-memory) –Ω–∞ –±—ç–∫–µ–Ω–¥–∞—Ö.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>2. –ë–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (Big Keys)</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ Redis –æ–±—ä–µ–∫—Ç—ã –ø–æ 5-10–ú–± (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTML —Ü–µ–ª–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã). –ß—Ç–µ–Ω–∏–µ —Ç–∞–∫–æ–≥–æ –∫–ª—é—á–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç Redis (–æ–Ω –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π) –Ω–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, —Å–æ–∑–¥–∞–≤–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –°–∂–∏–º–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ (gzip) –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ S3/CDN.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>3. Maxmemory-policy</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–í—Å–µ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –∫–æ–Ω—á–∏—Ç—Å—è, Redis –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å—å (OOM). –î–ª—è –∫—ç—à–∞ —Å—Ç–∞–≤—å—Ç–µ <code>allkeys-lru</code> (—É–¥–∞–ª—è—Ç—å —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç TTL).</p>
                        </div>
                    </div>
                </div>

                <h2>üí° –õ–∞–π—Ñ—Ö–∞–∫–∏</h2>
                <ul>
                    <li><strong>Two-Layer Cache (L1/L2):</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Å–Ω–∞—á–∞–ª–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤ –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (Dictionary, L1), –∞ –µ—Å–ª–∏ —Ç–∞–º –Ω–µ—Ç ‚Äî –≤ Redis (L2). –≠—Ç–æ —Å–Ω–∏–º–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É —Å Redis –∏ —Å–µ—Ç–∏. (–°–º. `aiocache`).</li>
                    <li><strong>Redis Pipelining:</strong> –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å 50 –∫–ª—é—á–µ–π, –Ω–µ –¥–µ–ª–∞–π—Ç–µ 50 –∑–∞–ø—Ä–æ—Å–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pipeline, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –ø–∞—á–∫–æ–π –∑–∞ 1 —Å–µ—Ç–µ–≤–æ–π RTT.</li>
                    <li><strong>Cache Defer:</strong> –ù–µ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∫—ç—à —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É –≤ Celery/Dramatiq ("–æ–±–Ω–æ–≤–∏ –∫—ç—à —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏"), —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–≤–µ—Ç.</li>
                </ul>

                <div class="task-box">
                    <h4>üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞</h4>
                    <ul class="task-list">
                        <li>–†–µ–∞–ª–∏–∑—É–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @cache —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Redis</li>
                        <li>–ù–∞—Å—Ç—Ä–æ–π Redis Eviction Policy (lru)</li>
                        <li>–°—ç–º—É–ª–∏—Ä—É–π Cache Stampede (50 –ø–æ—Ç–æ–∫–æ–≤) –∏ –ø–æ—á–∏–Ω–∏ —á–µ—Ä–µ–∑ Mutex</li>
                        <li>–í–Ω–µ–¥—Ä–∏ Bloom Filter –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö ID</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>
</body>
</html>