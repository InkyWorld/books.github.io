<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1.1 –°—Ö–µ–º–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî ScaleTrade</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="book-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üìà</div>
                    <span>ScaleTrade</span>
                </a>
            </div>
            
            <nav class="sidebar-nav">
    <div class="nav-section">
        <div class="nav-section-title">Intro</div>
        <a href="index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="setup.html" class="nav-link">üõ† Setup</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 0: Fundamentals</div>
        <a href="part0_internals.html" class="nav-link">0.1 Internals</a>
        <a href="part0_networking.html" class="nav-link">0.2 Networking</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 1: Postgres</div>
        <a href="part1_schema.html" class="nav-link active">1.1 Schema</a>
        <a href="part1_indexes.html" class="nav-link">1.2 Indexes</a>
        <a href="part1_transactions.html" class="nav-link">1.3 Transactions</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 2: Litestar</div>
        <a href="part2_litestar.html" class="nav-link">2.1 Framework</a>
        <a href="part2_dishka.html" class="nav-link">2.2 DI (Dishka)</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 3: Brokers</div>
        <a href="part3_redis.html" class="nav-link">3.1 Redis</a>
        <a href="part3_faststream.html" class="nav-link">3.2 FastStream</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 4: Quality</div>
        <a href="part4_testing.html" class="nav-link">4.1 Pytest</a>
        <a href="part4_resiliency.html" class="nav-link">4.2 Resilience</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 5: Observability</div>
        <a href="part5_clickhouse.html" class="nav-link">5.1 Clickhouse</a>
        <a href="part5_logging.html" class="nav-link">5.2 Structured Logs</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 6: Django</div>
        <a href="part6_django.html" class="nav-link">6.1 ORM</a>
        <a href="part6_migrations.html" class="nav-link">6.2 Migrations</a>
        <a href="part6_quality.html" class="nav-link">6.3 Quality</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 7: Microservices</div>
        <a href="part7_grpc.html" class="nav-link">7.1 gRPC</a>
        <a href="part7_graphql.html" class="nav-link">7.2 GraphQL</a>
        <a href="part7_federation.html" class="nav-link">7.3 Federation</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 8: Async</div>
        <a href="part8_asyncio.html" class="nav-link">8.1 Asyncio</a>
        <a href="part8_celery.html" class="nav-link">8.2 Celery</a>
        <a href="part8_dramatiq.html" class="nav-link">8.3 Dramatiq</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 9: API</div>
        <a href="part9_restdesign.html" class="nav-link">9.1 REST Design</a>
        <a href="part9_idempotency.html" class="nav-link">9.2 Idempotency</a>
        <a href="part9_openapi.html" class="nav-link">9.3 OpenAPI</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 10: Culture</div>
        <a href="part10_git.html" class="nav-link">10.1 Git</a>
        <a href="part10_commits.html" class="nav-link">10.2 Commits</a>
        <a href="part10_codereview.html" class="nav-link">10.3 Post-Review</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 11: Security</div>
        <a href="part11_oauth.html" class="nav-link">11.1 OAuth2</a>
        <a href="part11_vault.html" class="nav-link">11.2 Vault</a>
        <a href="part11_owasp.html" class="nav-link">11.3 OWASP</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 12: Kubernetes</div>
        <a href="part12_kubernetes.html" class="nav-link">12.1 K8s Basics</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 13: High Load</div>
        <a href="part13_profiling.html" class="nav-link">13.1 Profiling</a>
        <a href="part13_caching.html" class="nav-link">13.2 Caching</a>
        <a href="part13_loadbalancing.html" class="nav-link">13.3 Load Balancing</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 14: ML Ops</div>
        <a href="part14_mlflow.html" class="nav-link">14.1 MLflow</a>
        <a href="part14_embeddings.html" class="nav-link">14.2 Embeddings</a>
        <a href="part14_llm.html" class="nav-link">14.3 LLM</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 15: Debugging</div>
        <a href="part15_debugging.html" class="nav-link">15.1 Debugging</a>
        <a href="part15_postmortem.html" class="nav-link">15.2 Postmortem</a>
        <a href="part15_chaos.html" class="nav-link">15.3 Chaos Eng</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 16: DB Advanced</div>
        <a href="part16_indexes.html" class="nav-link">16.1 Indexes Deep</a>
        <a href="part16_isolation.html" class="nav-link">16.2 Isolation</a>
        <a href="part16_sharding.html" class="nav-link">16.3 Sharding</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 17: System Design</div>
        <a href="part17_circuit.html" class="nav-link">17.1 Circuit Breaker</a>
        <a href="part17_ratelimit.html" class="nav-link">17.2 Rate Limit</a>
        <a href="part17_distlock.html" class="nav-link">17.3 Dist Lock</a>
    </div>
    <div class="nav-section">
        <div class="nav-section-title">Part 18: Soft Skills</div>
        <a href="part18_estimation.html" class="nav-link">18.1 Estimation</a>
        <a href="part18_burnout.html" class="nav-link">18.2 Burnout</a>
        <a href="part18_interview.html" class="nav-link">18.3 Interview</a>
    </div>
</nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <div class="breadcrumb">
                    <a href="index.html">ScaleTrade</a>
                    <span>/</span>
                    <span>–ß–∞—Å—Ç—å 1</span>
                    <span>/</span>
                    <span>1.1 –°—Ö–µ–º–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                </div>
            </header>

                <div class="page-content">
                    <h1>–ú–æ–¥—É–ª—å 1.1: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏</h1>
                    <p class="lead">Primary Key ‚Äî —ç—Ç–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ —Å—Ö–µ–º–µ. –ò–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –Ω–∞ —á–∞—Å—ã –∏–ª–∏ –¥–Ω–∏. –í—ã–±–∏—Ä–∞–µ–º –º–µ–∂–¥—É BigInt –∏ UUID –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.</p>
    
                <h2>–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –∫—Ä–∞—Ç–∫–∏–π –∫—É—Ä—Å</h2>
                <p>
                    –ü—Ä–µ–∂–¥–µ —á–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã, –≤—Å–ø–æ–º–Ω–∏ –ø—Ä–æ 3-—é –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É (3NF). 
                    –≠—Ç–æ –∏–∑–±–∞–≤–∏—Ç –æ—Ç –∞–Ω–æ–º–∞–ª–∏–π –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
                </p>
                <ul>
                    <li><strong>1NF:</strong> –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å. –ù–∏–∫–∞–∫–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ (–º–∞—Å—Å–∏–≤—ã Postgres ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π —Å —É–º–æ–º).</li>
                    <li><strong>2NF:</strong> –í—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞. –í—ã–Ω–æ—Å–∏ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è.</li>
                    <li><strong>3NF:</strong> –ù–∏–∫–∞–∫–æ–π —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ü–æ–ª—è –∑–∞–≤–∏—Å—è—Ç —Ç–æ–ª—å–∫–æ –æ—Ç ID, –∞ –Ω–µ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.</li>
                </ul>
                <div class="info-box warning">
                    <div class="info-box-title">–ö–æ–≥–¥–∞ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å?</div>
                    <p>
                        –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ö–æ—Ä–æ—à–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ (INSERT/UPDATE), –Ω–æ –ø–ª–æ—Ö–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è (–º–Ω–æ–≥–æ JOIN).
                        –î–ª—è HighLoad —Å–∏—Å—Ç–µ–º –º—ã —á–∞—Å—Ç–æ <strong>–¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º</strong> –¥–∞–Ω–Ω—ã–µ (–¥—É–±–ª–∏—Ä—É–µ–º <code>user_name</code> –≤ —Ç–∞–±–ª–∏—Ü—É <code>orders</code>), 
                        —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å –±–µ–∑ JOIN-–æ–≤. –ù–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.
                    </p>
                </div>

                        <div class="comparison-col">
                            <h4>üî¢ BigInt (Identity/Serial)</h4>
                            <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ `1, 2, 3...`. –ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ 64-bit.</p>
                            
                            <strong>‚úÖ –ü–æ—á–µ–º—É –•–û–†–û–®–û:</strong>
                            <ul>
                                <li><strong>–†–∞–∑–º–µ—Ä:</strong> –í—Å–µ–≥–æ 8 –±–∞–π—Ç. –ò–Ω–¥–µ–∫—Å—ã –º–∞–ª–µ–Ω—å–∫–∏–µ, –≤–ª–µ–∑–∞—é—Ç –≤ RAM.</li>
                                <li><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–≥–æ –≤ –∫–æ–Ω–µ—Ü B-Tree (Locality). –°—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∏—Å–∫–∞ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ.</li>
                                <li><strong>–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:</strong> `users/5` –ø—Ä–æ—â–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å, —á–µ–º `users/a0eeb...`.</li>
                            </ul>
    
                            <strong>‚ùå –ü–æ—á–µ–º—É –ü–õ–û–•–û:</strong>
                            <ul>
                                <li><strong>Enumeration Attack:</strong> –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–±—Ä–∞—Ç—å `GET /orders/1`, `GET /orders/2` –∏ —É–∑–Ω–∞—Ç—å –æ–±—ä–µ–º –≤–∞—à–∏—Ö –∑–∞–∫–∞–∑–æ–≤.</li>
                                <li><strong>–°–ª–∏—è–Ω–∏–µ –±–∞–∑:</strong> –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ª–∏—Ç—å –¥–≤–µ –±–∞–∑—ã –±–µ–∑ –∫–æ–ª–ª–∏–∑–∏–π ID (1 –∏ 1).</li>
                                <li><strong>–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è:</strong> ID –≤—ã–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ú–∞—Å—Ç–µ—Ä –ë–î.</li>
                            </ul>
                        </div>
                        <div class="comparison-col">
                            <h4>üÜî UUID (v4 Random)</h4>
                            <p>–°–ª—É—á–∞–π–Ω—ã–µ 128-bit —Å—Ç—Ä–æ–∫–∏: `a0eebc99-9c0b...`.</p>
    
                            <strong>‚úÖ –ü–æ—á–µ–º—É –•–û–†–û–®–û:</strong>
                            <ul>
                                <li><strong>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å:</strong> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–ª–∏ –ª—é–±–æ–º –±—ç–∫–µ–Ω–¥–µ. –ù–æ–ª—å –∫–æ–ª–ª–∏–∑–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ.</li>
                                <li><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –ù–µ–ª—å–∑—è —É–≥–∞–¥–∞—Ç—å ID —Å–æ—Å–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.</li>
                                <li><strong>–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> –õ–µ–≥–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —à–∞—Ä–¥–∏–Ω–≥.</li>
                            </ul>
    
                            <strong>‚ùå –ü–æ—á–µ–º—É –ü–õ–û–•–û:</strong>
                            <ul>
                                <li><strong>–†–∞–∑–º–µ—Ä:</strong> 16 –±–∞–π—Ç (–≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ). –ò–Ω–¥–µ–∫—Å—ã –ø—É—Ö–Ω—É—Ç.</li>
                                <li><strong>–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (WAL Amplification):</strong> –°–ª—É—á–∞–π–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –≤ B-Tree –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∏–∂–æ–∫ –≥—Ä—É–∑–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –¥–∏—Å–∫–∞ ("Random I/O") –∏ —Ä–∞—Å—â–µ–ø–ª—è—Ç—å –∏—Ö. –≠—Ç–æ —É–±–∏–≤–∞–µ—Ç Insert-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö.</li>
                            </ul>
                        </div>
                    </div>
    
                    <h2>üèÜ –ó–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞: UUIDv7</h2>
                    <p>–ü—Ä–æ–±–ª–µ–º–∞ UUIDv4 –≤ –µ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏. UUIDv7 —Ä–µ—à–∞–µ—Ç —ç—Ç–æ, –¥–æ–±–∞–≤–ª—è—è Timestamp –≤ –Ω–∞—á–∞–ª–æ.</p>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">–ü–æ—á–µ–º—É UUIDv7?</div>
                        <p>–û–Ω <strong>—Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π</strong> (–∫–∞–∫ BigInt) –∏ <strong>—É–Ω–∏–∫–∞–ª—å–Ω—ã–π</strong> (–∫–∞–∫ UUID). –í—Å—Ç–∞–≤–∫–∞ –∏–¥–µ—Ç –≤ –∫–æ–Ω–µ—Ü –∏–Ω–¥–µ–∫—Å–∞, –Ω–µ –≤—ã–∑—ã–≤–∞—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü. –≠—Ç–æ "Best of both worlds".</p>
                    </div>

                <h3>–†–µ—à–µ–Ω–∏–µ: UUIDv7 –∏–ª–∏ Hybrid</h3>
                
                <p>
                    <strong>UUIDv7</strong> ‚Äî —ç—Ç–æ UUID —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –≤ –Ω–∞—á–∞–ª–µ. –û–Ω —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:
                </p>

<pre><code><span class="comment"># src/scaletrade/domain/value_objects/identifiers.py</span>
<span class="keyword">import</span> uuid
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone
<span class="keyword">from</span> typing <span class="keyword">import</span> Self


<span class="keyword">class</span> <span class="class-name">OrderId</span>:
    <span class="string">"""UUID v7 - —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è."""</span>
    
    __slots__ = (<span class="string">"_value"</span>,)
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self, value: uuid.UUID) -> <span class="keyword">None</span>:
        self._value = value
    
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">generate</span>(cls) -> Self:
        <span class="string">"""–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º UUIDv7 (RFC 9562)."""</span>
        <span class="comment"># Python 3.11+ –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ uuid7, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É</span>
        <span class="keyword">import</span> uuid6  <span class="comment"># pip install uuid6</span>
        <span class="keyword">return</span> cls(uuid6.uuid7())
    
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">from_string</span>(cls, value: <span class="type">str</span>) -> Self:
        <span class="keyword">return</span> cls(uuid.UUID(value))
    
    <span class="keyword">def</span> <span class="function">__str__</span>(self) -> <span class="type">str</span>:
        <span class="keyword">return</span> <span class="type">str</span>(self._value)
    
    <span class="keyword">def</span> <span class="function">__eq__</span>(self, other: object) -> <span class="type">bool</span>:
        <span class="keyword">if not</span> <span class="function">isinstance</span>(other, OrderId):
            <span class="keyword">return</span> <span class="keyword">False</span>
        <span class="keyword">return</span> self._value == other._value
    
    <span class="keyword">def</span> <span class="function">__hash__</span>(self) -> <span class="type">int</span>:
        <span class="keyword">return</span> <span class="function">hash</span>(self._value)
    
    <span class="decorator">@property</span>
    <span class="keyword">def</span> <span class="function">timestamp</span>(self) -> datetime:
        <span class="string">"""–ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑ UUIDv7."""</span>
        <span class="comment"># –ü–µ—Ä–≤—ã–µ 48 –±–∏—Ç ‚Äî Unix timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö</span>
        ts_ms = self._value.int >> <span class="number">80</span>
        <span class="keyword">return</span> datetime.fromtimestamp(ts_ms / <span class="number">1000</span>, tz=timezone.utc)</code></pre>

                <h3>–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥</h3>
                <p>
                    –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>BigInt –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö FK</strong> –∏ <strong>UUID –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ API</strong>:
                </p>

<pre><code><span class="comment"># SQLAlchemy –º–æ–¥–µ–ª—å —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º</span>
<span class="keyword">class</span> <span class="class-name">Order</span>(Base):
    __tablename__ = <span class="string">"orders"</span>
    
    <span class="comment"># –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –¥–ª—è FK –∏ –¥–∂–æ–∏–Ω–æ–≤ (–±—ã—Å—Ç—Ä—ã–π)</span>
    id: Mapped[<span class="type">int</span>] = mapped_column(BigInteger, primary_key=<span class="keyword">True</span>)
    
    <span class="comment"># –ü—É–±–ª–∏—á–Ω—ã–π ID –¥–ª—è API (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)</span>
    public_id: Mapped[uuid.UUID] = mapped_column(
        UUID(as_uuid=<span class="keyword">True</span>), 
        default=uuid6.uuid7,
        unique=<span class="keyword">True</span>,
        index=<span class="keyword">True</span>
    )</code></pre>

                <h2>Decimal –¥–ª—è –¥–µ–Ω–µ–≥: –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤</h2>

                <div class="info-box danger">
                    <div class="info-box-title">üö® –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π FLOAT –¥–ª—è –¥–µ–Ω–µ–≥</div>
                    <p>
                        <code>0.1 + 0.2 = 0.30000000000000004</code> ‚Äî —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, —ç—Ç–æ IEEE 754.
                        –í —Ñ–∏–Ω–∞–Ω—Å–∞—Ö —ç—Ç–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ.
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-col bad">
                        <h4>‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</h4>
<pre><code>price = Column(Float)

<span class="comment"># 0.1 + 0.2 = ?</span>
>>> 0.1 + 0.2
0.30000000000000004</code></pre>
                    </div>
                    <div class="comparison-col good">
                        <h4>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ</h4>
<pre><code>price = Column(Numeric(19, 4))

<span class="comment"># –¢–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</span>
>>> Decimal("0.1") + Decimal("0.2")
Decimal('0.3')</code></pre>
                    </div>
                </div>

                <h3>Value Object –¥–ª—è –¥–µ–Ω–µ–≥</h3>

<pre><code><span class="comment"># src/scaletrade/domain/value_objects/money.py</span>
<span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass
<span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, ROUND_HALF_UP
<span class="keyword">from</span> enum <span class="keyword">import</span> StrEnum
<span class="keyword">from</span> typing <span class="keyword">import</span> Self


<span class="keyword">class</span> <span class="class-name">Currency</span>(StrEnum):
    USD = <span class="string">"USD"</span>
    EUR = <span class="string">"EUR"</span>
    RUB = <span class="string">"RUB"</span>


<span class="decorator">@dataclass</span>(frozen=<span class="keyword">True</span>, slots=<span class="keyword">True</span>)
<span class="keyword">class</span> <span class="class-name">Money</span>:
    <span class="string">"""–ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π Value Object –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π."""</span>
    
    amount: Decimal
    currency: Currency
    
    <span class="keyword">def</span> <span class="function">__post_init__</span>(self) -> <span class="keyword">None</span>:
        <span class="comment"># –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏</span>
        <span class="keyword">if</span> self.amount < <span class="number">0</span>:
            <span class="keyword">raise</span> ValueError(<span class="string">"Amount cannot be negative"</span>)
        
        <span class="comment"># –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 4 –∑–Ω–∞–∫–æ–≤ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤)</span>
        <span class="keyword">object</span>.__setattr__(
            self, 
            <span class="string">"amount"</span>, 
            self.amount.quantize(Decimal(<span class="string">"0.0001"</span>), rounding=ROUND_HALF_UP)
        )
    
    <span class="keyword">def</span> <span class="function">__add__</span>(self, other: Self) -> Self:
        self._check_same_currency(other)
        <span class="keyword">return</span> Money(self.amount + other.amount, self.currency)
    
    <span class="keyword">def</span> <span class="function">__sub__</span>(self, other: Self) -> Self:
        self._check_same_currency(other)
        result = self.amount - other.amount
        <span class="keyword">if</span> result < <span class="number">0</span>:
            <span class="keyword">raise</span> ValueError(<span class="string">"Result cannot be negative"</span>)
        <span class="keyword">return</span> Money(result, self.currency)
    
    <span class="keyword">def</span> <span class="function">__mul__</span>(self, multiplier: Decimal | <span class="type">int</span>) -> Self:
        <span class="keyword">return</span> Money(self.amount * Decimal(multiplier), self.currency)
    
    <span class="keyword">def</span> <span class="function">_check_same_currency</span>(self, other: Self) -> <span class="keyword">None</span>:
        <span class="keyword">if</span> self.currency != other.currency:
            <span class="keyword">raise</span> ValueError(
                <span class="string">f"Cannot operate on different currencies: "</span>
                <span class="string">f"</span>{self.currency}<span class="string"> vs </span>{other.currency}<span class="string">"</span>
            )
    
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">zero</span>(cls, currency: Currency) -> Self:
        <span class="keyword">return</span> cls(Decimal(<span class="string">"0"</span>), currency)
    
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">from_cents</span>(cls, cents: <span class="type">int</span>, currency: Currency) -> Self:
        <span class="string">"""–°–æ–∑–¥–∞—ë–º –∏–∑ —Ü–µ–Ω—Ç–æ–≤ (–∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü)."""</span>
        <span class="keyword">return</span> cls(Decimal(cents) / <span class="number">100</span>, currency)</code></pre>

                <h2>–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã Orders</h2>
                
                <p>
                    –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ —Ç–∞–±–ª–∏—Ü–∞ <code>orders</code> –≤—ã—Ä–∞—Å—Ç–µ—Ç –¥–æ –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤ –∑–∞–ø–∏—Å–µ–π.
                    <strong>–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç:
                </p>
                <ul>
                    <li>–ë—ã—Å—Ç—Ä–µ–µ –∏—Å–∫–∞—Ç—å –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç (—Å–∫–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏)</li>
                    <li>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (DROP PARTITION –≤–º–µ—Å—Ç–æ DELETE)</li>
                    <li>–†–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º</li>
                </ul>

<pre><code><span class="comment">-- –°–æ–∑–¥–∞—ë–º –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É</span>
<span class="keyword">CREATE TABLE</span> orders (
    id              BIGINT <span class="keyword">GENERATED ALWAYS AS IDENTITY</span>,
    public_id       UUID <span class="keyword">NOT NULL DEFAULT</span> gen_random_uuid(),
    user_id         BIGINT <span class="keyword">NOT NULL</span>,
    symbol          VARCHAR(20) <span class="keyword">NOT NULL</span>,
    side            VARCHAR(4) <span class="keyword">NOT NULL CHECK</span> (side <span class="keyword">IN</span> ('BUY', 'SELL')),
    quantity        NUMERIC(19, 8) <span class="keyword">NOT NULL CHECK</span> (quantity > 0),
    price           NUMERIC(19, 4) <span class="keyword">NOT NULL CHECK</span> (price > 0),
    status          VARCHAR(20) <span class="keyword">NOT NULL DEFAULT</span> 'pending',
    created_at      TIMESTAMPTZ <span class="keyword">NOT NULL DEFAULT</span> now(),
    updated_at      TIMESTAMPTZ <span class="keyword">NOT NULL DEFAULT</span> now(),
    
    <span class="keyword">PRIMARY KEY</span> (id, created_at)  <span class="comment">-- PK –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏!</span>
) <span class="keyword">PARTITION BY RANGE</span> (created_at);

<span class="comment">-- –°–æ–∑–¥–∞—ë–º –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ 2024 –≥–æ–¥</span>
<span class="keyword">CREATE TABLE</span> orders_2024_01 <span class="keyword">PARTITION OF</span> orders
    <span class="keyword">FOR VALUES FROM</span> ('2024-01-01') <span class="keyword">TO</span> ('2024-02-01');

<span class="keyword">CREATE TABLE</span> orders_2024_02 <span class="keyword">PARTITION OF</span> orders
    <span class="keyword">FOR VALUES FROM</span> ('2024-02-01') <span class="keyword">TO</span> ('2024-03-01');

<span class="comment">-- ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ</span>

<span class="comment">-- –ò–Ω–¥–µ–∫—Å –Ω–∞ public_id (–¥–ª—è API lookups)</span>
<span class="keyword">CREATE UNIQUE INDEX</span> idx_orders_public_id <span class="keyword">ON</span> orders (public_id);

<span class="comment">-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="keyword">CREATE INDEX</span> idx_orders_user_created <span class="keyword">ON</span> orders (user_id, created_at <span class="keyword">DESC</span>);</code></pre>

                <div class="info-box tip">
                    <div class="info-box-title">üí° –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π</div>
                    <p>
                        –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π <code>pg_partman</code> ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL, 
                        –∫–æ—Ç–æ—Ä–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∏ —É–¥–∞–ª—è–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏.
                    </p>
                </div>

                <h2>Database Constraints: –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î</h2>
                
                <p>
                    –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–µ.
                    –ö–æ–¥ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏, –±–∞–∑—É ‚Äî –Ω–µ—Ç.
                </p>

                <h3>CHECK Constraints</h3>

<pre><code><span class="comment">-- –ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º</span>
<span class="keyword">ALTER TABLE</span> accounts 
<span class="keyword">ADD CONSTRAINT</span> chk_balance_positive <span class="keyword">CHECK</span> (balance >= 0);

<span class="comment">-- –°—Ç–∞—Ç—É—Å –æ—Ä–¥–µ—Ä–∞ –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Å–ø–∏—Å–∫–∞</span>
<span class="keyword">ALTER TABLE</span> orders
<span class="keyword">ADD CONSTRAINT</span> chk_order_status <span class="keyword">CHECK</span> (
    status <span class="keyword">IN</span> ('pending', 'filled', 'cancelled', 'rejected')
);

<span class="comment">-- –¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–µ–Ω—å—à–µ —Ü–µ–Ω—ã –ø—Ä–æ–¥–∞–∂–∏ (–¥–ª—è –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤)</span>
<span class="keyword">ALTER TABLE</span> limit_orders
<span class="keyword">ADD CONSTRAINT</span> chk_price_range <span class="keyword">CHECK</span> (stop_price < limit_price);</code></pre>

                <h3>EXCLUDE Constraint: –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞</h3>
                
                <p>
                    <strong>–ó–∞–¥–∞—á–∞:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ—Ä–¥–µ—Ä –ø–æ —Å–∏–º–≤–æ–ª—É, 
                    –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–π –æ—Ä–¥–µ—Ä –ø–æ —Ç–æ–º—É –∂–µ —Å–∏–º–≤–æ–ª—É.
                </p>

<pre><code><span class="comment">-- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ btree_gist</span>
<span class="keyword">CREATE EXTENSION IF NOT EXISTS</span> btree_gist;

<span class="comment">-- –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤</span>
<span class="keyword">ALTER TABLE</span> orders
<span class="keyword">ADD CONSTRAINT</span> excl_one_active_order_per_symbol
<span class="keyword">EXCLUDE USING</span> gist (
    user_id <span class="keyword">WITH</span> =,
    symbol <span class="keyword">WITH</span> =,
    <span class="comment">-- –î–∏–∞–ø–∞–∑–æ–Ω "–∂–∏–∑–Ω–∏" –æ—Ä–¥–µ—Ä–∞: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è</span>
    tstzrange(created_at, closed_at, '[)') <span class="keyword">WITH</span> &&
) <span class="keyword">WHERE</span> (status = 'pending');

<span class="comment">-- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –∑–∞–ø–∏—Å–µ–π, –≥–¥–µ:</span>
<span class="comment">-- 1. user_id –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π</span>
<span class="comment">-- 2. symbol –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π</span>
<span class="comment">-- 3. –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è</span>
<span class="comment">-- 4. —Å—Ç–∞—Ç—É—Å = pending</span></code></pre>

                <h2>SQLAlchemy 2.0: –º–æ–¥–µ–ª–∏</h2>
                
                <p>–°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤–º–µ—Å—Ç–µ –≤ SQLAlchemy –º–æ–¥–µ–ª—å:</p>

<pre><code><span class="comment"># src/scaletrade/infrastructure/database/models.py</span>
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal
<span class="keyword">from</span> enum <span class="keyword">import</span> StrEnum
<span class="keyword">from</span> typing <span class="keyword">import</span> Optional
<span class="keyword">import</span> uuid

<span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> (
    BigInteger, CheckConstraint, Index, Numeric, String, func
)
<span class="keyword">from</span> sqlalchemy.dialects.postgresql <span class="keyword">import</span> UUID, TIMESTAMP
<span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> DeclarativeBase, Mapped, mapped_column


<span class="keyword">class</span> <span class="class-name">OrderSide</span>(StrEnum):
    BUY = <span class="string">"BUY"</span>
    SELL = <span class="string">"SELL"</span>


<span class="keyword">class</span> <span class="class-name">OrderStatus</span>(StrEnum):
    PENDING = <span class="string">"pending"</span>
    FILLED = <span class="string">"filled"</span>
    CANCELLED = <span class="string">"cancelled"</span>
    REJECTED = <span class="string">"rejected"</span>


<span class="keyword">class</span> <span class="class-name">Base</span>(DeclarativeBase):
    <span class="keyword">pass</span>


<span class="keyword">class</span> <span class="class-name">Order</span>(Base):
    __tablename__ = <span class="string">"orders"</span>
    
    <span class="comment"># Primary Key (–≤–∫–ª—é—á–∞–µ—Ç –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏)</span>
    id: Mapped[<span class="type">int</span>] = mapped_column(BigInteger, primary_key=<span class="keyword">True</span>)
    created_at: Mapped[datetime] = mapped_column(
        TIMESTAMP(timezone=<span class="keyword">True</span>),
        primary_key=<span class="keyword">True</span>,  <span class="comment"># –ß–∞—Å—Ç—å –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ–≥–æ PK –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</span>
        server_default=func.now()
    )
    
    <span class="comment"># Public identifier</span>
    public_id: Mapped[uuid.UUID] = mapped_column(
        UUID(as_uuid=<span class="keyword">True</span>),
        default=uuid.uuid4,
        unique=<span class="keyword">True</span>
    )
    
    <span class="comment"># Relations</span>
    user_id: Mapped[<span class="type">int</span>] = mapped_column(BigInteger, nullable=<span class="keyword">False</span>)
    
    <span class="comment"># Order details</span>
    symbol: Mapped[<span class="type">str</span>] = mapped_column(String(20), nullable=<span class="keyword">False</span>)
    side: Mapped[OrderSide] = mapped_column(String(4), nullable=<span class="keyword">False</span>)
    
    <span class="comment"># Money fields - ALWAYS Numeric, never Float!</span>
    quantity: Mapped[Decimal] = mapped_column(
        Numeric(19, 8), 
        nullable=<span class="keyword">False</span>
    )
    price: Mapped[Decimal] = mapped_column(
        Numeric(19, 4), 
        nullable=<span class="keyword">False</span>
    )
    
    <span class="comment"># Status</span>
    status: Mapped[OrderStatus] = mapped_column(
        String(20), 
        default=OrderStatus.PENDING
    )
    
    <span class="comment"># Timestamps</span>
    updated_at: Mapped[datetime] = mapped_column(
        TIMESTAMP(timezone=<span class="keyword">True</span>),
        server_default=func.now(),
        onupdate=func.now()
    )
    closed_at: Mapped[Optional[datetime]] = mapped_column(
        TIMESTAMP(timezone=<span class="keyword">True</span>),
        nullable=<span class="keyword">True</span>
    )
    
    __table_args__ = (
        <span class="comment"># CHECK constraints</span>
        CheckConstraint(<span class="string">"quantity > 0"</span>, name=<span class="string">"chk_quantity_positive"</span>),
        CheckConstraint(<span class="string">"price > 0"</span>, name=<span class="string">"chk_price_positive"</span>),
        CheckConstraint(
            <span class="string">"side IN ('BUY', 'SELL')"</span>, 
            name=<span class="string">"chk_order_side"</span>
        ),
        
        <span class="comment"># Indexes</span>
        Index(<span class="string">"idx_orders_user_created"</span>, <span class="string">"user_id"</span>, <span class="string">"created_at"</span>),
        Index(<span class="string">"idx_orders_status"</span>, <span class="string">"status"</span>, postgresql_where=(status == <span class="string">"pending"</span>)),
        
        <span class="comment"># Partitioning hint (DDL –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)</span>
        {<span class="string">"postgresql_partition_by"</span>: <span class="string">"RANGE (created_at)"</span>}
    )</code></pre>

                <h2>ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>1. Float –¥–ª—è –¥–µ–Ω–µ–≥</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ù–∏–∫–æ–≥–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>Numeric/Decimal</code> –∏–ª–∏ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ (—Ü–µ–Ω—Ç—ã/–∫–æ–ø–µ–π–∫–∏). Float ‚Äî —ç—Ç–æ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>2. Boolean –∏ NULL</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ò–∑–±–µ–≥–∞–π—Ç–µ <code>Nullable Boolean</code>. –≠—Ç–æ —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: True, False –∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ". –û–±—ã—á–Ω–æ —ç—Ç–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ <code>NOT NULL DEFAULT FALSE</code>.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <strong>3. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å FK –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞</strong>
                        </div>
                        <div class="accordion-content">
                            <p>–ï—Å–ª–∏ –≤—ã —É–¥–∞–ª—è–µ—Ç–µ –∑–∞–ø–∏—Å—å –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã, Postgres –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —Å—Å—ã–ª–∫–∏. –ï—Å–ª–∏ –Ω–∞ FK-–∫–æ–ª–æ–Ω–∫–µ –≤ –¥–æ—á–µ—Ä–Ω–µ–π —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–ª–Ω–æ–º—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –¥–æ—á–µ—Ä–Ω–µ–π —Ç–∞–±–ª–∏—Ü—ã –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º.</p>
                        </div>
                    </div>
                </div>

                <h2>üí° –õ–∞–π—Ñ—Ö–∞–∫–∏</h2>
                <ul>
                    <li><strong>Timestamp:</strong> –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>TIMESTAMPTZ</code> (timestamp with time zone). –•—Ä–∞–Ω–∏—Ç–µ –≤—Å—ë –≤ UTC. –ü—Ä–æ—Å—Ç–æ <code>TIMESTAMP</code> ‚Äî —ç—Ç–æ –º–∏–Ω–∞ –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.</li>
                    <li><strong>UUIDv7:</strong> –í–º–µ—Å—Ç–æ v4 –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ v7. –û–Ω–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ B-Tree –∏–Ω–¥–µ–∫—Å–æ–≤ (—É–º–µ–Ω—å—à–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü).</li>
                    <li><strong>Soft Delete:</strong> –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–∂–æ–∫ <code>is_deleted</code>. –≠—Ç–æ –ª–æ–º–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ FK. –õ—É—á—à–µ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É <code>xxx_archive</code>.</li>
                </ul>

                <div class="task-box">
                    <h4>üìã –ó–∞–¥–∞–Ω–∏–µ</h4>
                    <ul class="task-list">
                        <li>–°–æ–∑–¥–∞–π Value Object <code>Money</code> —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏</li>
                        <li>–°–æ–∑–¥–∞–π SQLAlchemy –º–æ–¥–µ–ª—å <code>Account</code> —Å –±–∞–ª–∞–Ω—Å–æ–º (Decimal)</li>
                        <li>–ù–∞–ø–∏—à–∏ –º–∏–≥—Ä–∞—Ü–∏—é Alembic –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã orders</li>
                        <li>–î–æ–±–∞–≤—å EXCLUDE constraint –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤</li>
                        <li>–ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π —á—Ç–æ CHECK constraint —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å)</li>
                    </ul>
                </div>

                <div class="info-box info">
                    <div class="info-box-title">üí° –ß—Ç–æ –¥–∞–ª—å—à–µ?</div>
                    <p>
                        –í —Å–ª–µ–¥—É—é—â–µ–º –º–æ–¥—É–ª–µ –º—ã –ø–æ–≥—Ä—É–∑–∏–º—Å—è –≤ <strong>—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</strong>: 
                        —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, deadlocks –∏ –ø–∞—Ç—Ç–µ—Ä–Ω SELECT FOR UPDATE.
                    </p>
                </div>

                <div class="nav-footer">
                    <a href="setup.html">
                        <div>
                            <div class="nav-label">–ù–∞–∑–∞–¥</div>
                            <div class="nav-title">‚Üê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</div>
                        </div>
                    </a>
                    <a href="part1_transactions.html">
                        <div>
                            <div class="nav-label">–î–∞–ª–µ–µ</div>
                            <div class="nav-title">1.2 –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí</div>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
